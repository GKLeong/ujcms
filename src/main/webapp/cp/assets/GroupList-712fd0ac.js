import{d as Q,r as p,a as v,c as B,e as R,w as t,i,h as l,I as H,a8 as se,a7 as X,p as te,u as J,X as W,v as oe,o as Y,j as I,g as Z,k as C,t as P,V as S,E as x,b as ne,f as ue,aD as ie,aI as de,cw as re,as as D,a4 as me,a1 as pe}from"./index-07310ff6.js";import{C as ee,D as ce,E as ve,F as le,G as fe,H as be,f as _e,I as ye}from"./user-9466be0b.js";import{a as K,_ as ge,b as $e,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-a4f060b2.js";import{_ as ke}from"./ListMove.vue_vue_type_script_setup_true_lang-94f3400b.js";import{_ as he}from"./DialogForm.vue_vue_type_script_setup_true_lang-84cdaac8.js";import{_ as ae}from"./LabelTip.vue_vue_type_script_setup_true_lang-2883fbbc.js";import{t as Ce}from"./tree-7e647485.js";import{f as Pe}from"./content-57570363.js";const we={name:"GroupForm"},Ae=Q({...we,props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(w){const A=p(),c=p({});return(n,m)=>{const $=v("el-input"),_=v("el-form-item"),V=v("el-switch"),b=v("el-option"),k=v("el-select");return B(),R(he,{name:n.$t("menu.user.group"),queryBean:i(ee),createBean:i(ce),updateBean:i(ve),deleteBean:i(le),beanId:w.beanId,beanIds:w.beanIds,focus:A.value,initValues:()=>({type:2,allAccessPermission:!0}),toValues:a=>({...a}),disableDelete:a=>a.id<=10,perms:"group",values:c.value,"onUpdate:values":m[4]||(m[4]=a=>c.value=a),"model-value":w.modelValue,"onUpdate:modelValue":m[5]||(m[5]=a=>n.$emit("update:modelValue",a)),onFinished:m[6]||(m[6]=a=>n.$emit("finished"))},{default:t(({})=>[l(_,{prop:"name",label:n.$t("group.name"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:t(()=>[l($,{modelValue:c.value.name,"onUpdate:modelValue":m[0]||(m[0]=a=>c.value.name=a),ref_key:"focus",ref:A,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(_,{prop:"description",label:n.$t("group.description")},{default:t(()=>[l($,{modelValue:c.value.description,"onUpdate:modelValue":m[1]||(m[1]=a=>c.value.description=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{prop:"allAccessPermission"},{label:t(()=>[l(ae,{message:"group.allAccessPermission"})]),default:t(()=>[l(V,{modelValue:c.value.allAccessPermission,"onUpdate:modelValue":m[2]||(m[2]=a=>c.value.allAccessPermission=a)},null,8,["modelValue"])]),_:1}),l(_,{prop:"type",label:n.$t("group.type"),rules:{required:!0,message:()=>n.$t("v.required")}},{default:t(()=>[l(k,{modelValue:c.value.type,"onUpdate:modelValue":m[3]||(m[3]=a=>c.value.type=a),disabled:c.value.type===1},{default:t(()=>[(B(),H(X,null,se([1,2],a=>l(b,{key:a,disabled:a===1,label:n.$t(`group.type.${a}`),value:a},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","values","model-value"])}}}),Ie={class:"border-t"},Be={class:"flex justify-between items-center"},De={name:"UserPermissionForm"},Ue=Q({...De,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(w,{emit:A}){const c=w,{beanId:n,modelValue:m}=te(c),{t:$}=J(),_=p(),V=p({}),b=p({}),k=p(!1),a=p(!0),E=p(!1),g=p(),y=p([]),F=W(()=>S.rank>V.value.rank),L=async()=>{(n==null?void 0:n.value)!=null&&(V.value=await ee(n.value),b.value={...V.value})},T=async()=>{y.value=Ce(await Pe())},z=async()=>{var r;if((n==null?void 0:n.value)!=null){const e=await be(n.value);(r=g.value)==null||r.setCheckedKeys([]),e.forEach(s=>{var o;(o=g.value)==null||o.setChecked(s,!0,!1)})}};oe(m,()=>{m.value&&(L(),z())}),Y(()=>{T()});const U=(r,e,s,o)=>{s.forEach(f=>{f.children&&(e.getNode(f[o!=null?o:"key"]).expanded=r,U(r,e,f.children,o))})},j=(r,e,s,o)=>{e.setCheckedKeys(r?s.map(f=>f[o!=null?o:"key"]):[])},q=()=>{_.value.validate(async r=>{if(r){k.value=!0;try{await fe(b.value),A("finished"),A("update:modelValue",!1),x.success($("success"))}finally{k.value=!1}}})},G=()=>{g.value!=null&&(b.value.accessPermissions=[...g.value.getCheckedNodes(),...g.value.getHalfCheckedNodes()].map(r=>r.id))};return(r,e)=>{const s=v("el-switch"),o=v("el-form-item"),f=v("el-checkbox"),h=v("el-tree"),M=v("el-form"),O=v("el-tag"),N=v("el-button"),u=v("el-drawer");return B(),R(u,{title:r.$t("permissionSettings"),"model-value":w.modelValue,"onUpdate:modelValue":e[8]||(e[8]=d=>r.$emit("update:modelValue",d)),size:414},{default:t(()=>[l(M,{ref_key:"form",ref:_,model:b.value,disabled:i(F),"label-width":"150px"},{default:t(()=>[l(o,{prop:"allAccessPermission"},{label:t(()=>[l(ae,{message:"group.allAccessPermission",help:""})]),default:t(()=>[l(s,{modelValue:b.value.allAccessPermission,"onUpdate:modelValue":e[0]||(e[0]=d=>b.value.allAccessPermission=d)},null,8,["modelValue"])]),_:1}),b.value.allAccessPermission?Z("",!0):(B(),H(X,{key:0},[I("div",Ie,[l(f,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=d=>a.value=d),onChange:e[2]||(e[2]=d=>U(d,g.value,y.value,"id")),label:r.$t("expand/collapse")},null,8,["modelValue","label"]),l(f,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=d=>E.value=d),onChange:e[4]||(e[4]=d=>{j(d,g.value,y.value,"id"),G()}),label:r.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),l(h,{ref_key:"accessPermissionTree",ref:g,data:y.value,"node-key":"id",onCheck:e[5]||(e[5]=d=>G()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:t(()=>[I("div",Be,[I("div",null,[l(O,null,{default:t(()=>{var d;return[C(P((d=b.value)==null?void 0:d.name),1)]}),_:1})]),I("div",null,[l(N,{onClick:e[6]||(e[6]=d=>r.$emit("update:modelValue",!1))},{default:t(()=>[C(P(r.$t("cancel")),1)]),_:1}),l(N,{type:"primary",onClick:e[7]||(e[7]=d=>q()),loading:k.value,disabled:i(F)},{default:t(()=>[C(P(r.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),qe={class:"mb-3"},Ge={class:"app-block mt-3"},Se={name:"GroupList"},Me=Q({...Se,setup(w){const{t:A}=J(),c=p({}),n=p(),m=p(),$=p([]),_=p([]),V=p(!1),b=p(!1),k=p(!1),a=p(),E=W(()=>$.value.map(e=>e.id)),g=p(!1),y=async()=>{V.value=!0;try{$.value=await _e({...ie(c.value),Q_OrderBy:n.value}),g.value=Object.values(c.value).filter(e=>e!==void 0&&e!=="").length>0||n.value!==void 0}finally{V.value=!1}};Y(y);const F=({column:e,prop:s,order:o})=>{var f;s?n.value=((f=e.sortBy)!=null?f:s)+(o==="descending"?"_desc":""):n.value=void 0,y()},L=()=>y(),T=()=>{m.value.clearSort(),de(c.value),n.value=void 0,y()},z=()=>{a.value=void 0,b.value=!0},U=e=>{a.value=e,b.value=!0},j=e=>{a.value=e,k.value=!0},q=e=>e>10,G=async e=>{const s=e.filter(o=>q(o));s.length>0&&(await le(s),y(),x.success(A("success")))},r=async(e,s)=>{const o=re(e,$.value,s);await ye(o.map(f=>f.id))};return(e,s)=>{const o=v("el-button"),f=v("el-popconfirm"),h=v("el-table-column"),M=v("el-tag"),O=v("el-table"),N=ne("loading");return B(),H("div",null,[I("div",qe,[l(i(ge),{params:c.value,onSearch:L,onReset:T},{default:t(()=>[l(i(K),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),l(i(K),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),I("div",null,[l(o,{type:"primary",disabled:i(D)("group:create"),icon:i(me),onClick:z},{default:t(()=>[C(P(e.$t("add")),1)]),_:1},8,["disabled","icon"]),l(f,{title:e.$t("confirmDelete"),onConfirm:s[0]||(s[0]=u=>G(_.value.map(d=>d.id)))},{reference:t(()=>[l(o,{disabled:_.value.filter(u=>q(u.id)).length<=0||i(D)("group:delete"),icon:i(pe)},{default:t(()=>[C(P(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ke,{class:"ml-2",disabled:_.value.length<=0||g.value||i(D)("org:update"),onMove:s[1]||(s[1]=u=>r(_.value,u))},null,8,["disabled"]),l(i($e),{name:"group",class:"ml-2"})]),I("div",Ge,[ue((B(),R(O,{ref_key:"table",ref:m,data:$.value,onSelectionChange:s[2]||(s[2]=u=>_.value=u),onRowDblclick:s[3]||(s[3]=u=>U(u.id)),onSortChange:F},{default:t(()=>[l(i(Ve),{name:"group"},{default:t(()=>[l(h,{type:"selection",width:"50"}),l(h,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(h,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:t(({row:u})=>[l(M,{type:u.allAccessPermission?"success":"info",size:"small"},{default:t(()=>[C(P(e.$t(u.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(h,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:u=>e.$t(`group.type.${u.type}`)},null,8,["label","formatter"]),l(h,{label:e.$t("table.action")},{default:t(({row:u})=>[l(o,{type:"primary",disabled:i(D)("group:update"),onClick:d=>U(u.id),size:"small",link:""},{default:t(()=>[C(P(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),i(S).epRank>0||i(S).epDisplay?(B(),R(o,{key:0,type:"primary",onClick:d=>j(u.id),disabled:i(D)("group:updatePermission")||i(S).epRank<=0,title:i(S).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:""},{default:t(()=>[C(P(e.$t("permissionSettings")),1)]),_:2},1032,["onClick","disabled","title"])):Z("",!0),l(f,{title:e.$t("confirmDelete"),onConfirm:d=>G([u.id])},{reference:t(()=>[l(o,{type:"primary",disabled:!q(u.id)||i(D)("group:delete"),size:"small",link:""},{default:t(()=>[C(P(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[N,V.value]])]),l(Ae,{modelValue:b.value,"onUpdate:modelValue":s[4]||(s[4]=u=>b.value=u),beanId:a.value,beanIds:i(E),onFinished:y},null,8,["modelValue","beanId","beanIds"]),l(Ue,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=u=>k.value=u),beanId:a.value,onFinished:y},null,8,["modelValue","beanId"])])}}});export{Me as default};
