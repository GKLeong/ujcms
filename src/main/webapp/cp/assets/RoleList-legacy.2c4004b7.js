System.register(["./vendor-legacy.138a6237.js","./index-legacy.f1446c47.js","./user-legacy.3ca83d8c.js","./QueryItem-legacy.2a219297.js","./ListMove-legacy.50ae296e.js","./DialogForm-legacy.5dac55b4.js","./LabelTip-legacy.de538b98.js","./data-legacy.7bb9a242.js","./tree-legacy.a39fb697.js","./content-legacy.a282592d.js"],(function(e){"use strict";var l,a,o,t,u,n,d,s,i,r,m,c,p,v,b,f,y,g,k,V,h,$,_,w,C,P,q,U,x,I,j,A,B,S,z,N,D,F,R,Q,E,M,T,H,K,L,O,G,J,W;return{setters:[function(e){l=e.g,a=e.I,o=e.j,t=e.o,u=e.k,n=e.w,d=e.l,s=e.m,i=e.q,r=e.C,m=e.F,c=e.P,p=e.A,v=e.t,b=e.u,f=e.i,y=e.R,g=e.M,k=e.y,V=e.x,h=e.Q,$=e.N,_=e.ao,w=e.O,C=e.an},function(e){P=e.c,q=e.p,U=e.t,x=e.r,I=e.k},function(e){j=e.r,A=e.k,B=e.l,S=e.n,z=e.o,N=e.p,D=e.s,F=e.g,R=e.t},function(e){Q=e.a,E=e.b,M=e._,T=e.c},function(e){H=e._},function(e){K=e._},function(e){L=e._},function(e){O=e.b},function(e){G=e.b,J=e.t},function(e){W=e.f}],execute:function(){const X=l({name:"RoleForm",props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e){const l=a(),v=a({});return(a,b)=>{const f=o("el-input"),y=o("el-form-item"),g=o("el-input-number"),k=o("el-option"),V=o("el-select"),h=o("el-radio"),$=o("el-radio-group");return t(),u(K,{name:a.$t("menu.user.role"),queryBean:s(A),createBean:s(B),updateBean:s(S),deleteBean:s(z),beanId:e.beanId,beanIds:e.beanIds,focus:l.value,initValues:()=>({type:4,rank:s(P).rank+1,scope:0}),toValues:e=>({...e}),disableDelete:e=>e.id<=1,disableEdit:e=>e.global&&!s(P).globalPermission||s(P).rank>e.rank,perms:"role",values:v.value,"onUpdate:values":b[5]||(b[5]=e=>v.value=e),"model-value":e.modelValue,"onUpdate:modelValue":b[6]||(b[6]=e=>a.$emit("update:modelValue",e)),onFinished:b[7]||(b[7]=e=>a.$emit("finished"))},{default:n((({bean:e,disabled:o})=>[d(y,{prop:"name",label:a.$t("role.name"),rules:{required:!0,message:()=>a.$t("v.required")}},{default:n((()=>[d(f,{modelValue:v.value.name,"onUpdate:modelValue":b[0]||(b[0]=e=>v.value.name=e),ref_key:"focus",ref:l,maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"]),d(y,{prop:"description",label:a.$t("role.description")},{default:n((()=>[d(f,{modelValue:v.value.description,"onUpdate:modelValue":b[1]||(b[1]=e=>v.value.description=e),maxlength:"300"},null,8,["modelValue"])])),_:1},8,["label"]),d(y,{prop:"rank",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:n((()=>[d(L,{message:"role.rank",help:""})])),default:n((()=>[d(g,{modelValue:v.value.rank,"onUpdate:modelValue":b[2]||(b[2]=e=>v.value.rank=e),modelModifiers:{number:!0},min:o?0:s(P).rank,max:32767},null,8,["modelValue","min"])])),_:2},1032,["rules"]),d(y,{prop:"type",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:n((()=>[d(L,{message:"role.type",help:""})])),default:n((()=>[d(V,{modelValue:v.value.type,"onUpdate:modelValue":b[3]||(b[3]=e=>v.value.type=e)},{default:n((()=>[(t(),i(m,null,r([1,2,3,4],(e=>d(k,{key:e,label:a.$t(`role.type.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"]),d(y,{prop:"scope",label:a.$t("block.scope"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(l,o,t)=>{o!==e.scope&&await s(j)(v.value.scope)&&t(a.$t("role.error.scopeNotAllowd")),t()}}]},{default:n((()=>[d($,{modelValue:v.value.scope,"onUpdate:modelValue":b[4]||(b[4]=e=>v.value.scope=e)},{default:n((()=>[(t(),i(m,null,r([0,2],(e=>d(h,{key:e,label:e,disabled:!s(P).globalPermission},{default:n((()=>[c(p(a.$t(`role.scope.${e}`)),1)])),_:2},1032,["label","disabled"]))),64))])),_:1},8,["modelValue"])])),_:2},1032,["label","rules"])])),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","disableEdit","values","model-value"])}}}),Y={class:"border-t"},Z={class:"flex justify-between items-center"},ee=l({name:"RolePermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){var $;const _=e,{beanId:w,modelValue:C}=v(_),{t:q}=b(),U=a("permission"),x=a(),I=a({}),j=a({}),B=a(!1),S=a(!0),z=a(!1),F=a(),R=a(!0),Q=a(!1),E=a(),M=a(!0),T=a(!1),H=a(),K=O();G(K,null!==($=P.grantPermissions)&&void 0!==$?$:[]);const X=a([]),ee=f((()=>I.value.global&&!P.globalPermission||P.rank>I.value.rank));y(C,(()=>{C.value&&((async()=>{var e,l,a,o,t,u;null!=(null==w?void 0:w.value)&&(I.value=await A(w.value),j.value={...I.value},null===(e=F.value)||void 0===e||e.setCheckedKeys(null!==(l=null===(a=I.value.permission)||void 0===a?void 0:a.split(","))&&void 0!==l?l:[]),null===(o=E.value)||void 0===o||o.setCheckedKeys(null!==(t=null===(u=I.value.grantPermission)||void 0===u?void 0:u.split(","))&&void 0!==t?t:[]))})(),(async()=>{null!=(null==w?void 0:w.value)&&(await D(w.value)).forEach((e=>{var l;null===(l=H.value)||void 0===l||l.setChecked(e,!0,!1)}))})())})),g((()=>{(async()=>{X.value=J(await W())})()}));const le=(e,l,a,o)=>{a.forEach((a=>{a.children&&(l.getNode(a[null!=o?o:"key"]).expanded=e,le(e,l,a.children,o))}))},ae=(e,l,a,o)=>{l.setCheckedKeys(e?a.map((e=>e[null!=o?o:"key"])):[])},oe=()=>{j.value.permission=ne(F.value.getCheckedNodes(),F.value.getHalfCheckedNodes())},te=()=>{j.value.grantPermission=ne(E.value.getCheckedNodes(),E.value.getHalfCheckedNodes())},ue=()=>{j.value.articlePermissions=[...H.value.getCheckedNodes(),...H.value.getHalfCheckedNodes()].map((e=>e.id))},ne=(e,l)=>[...e,...l].filter((e=>e.perms)).map((e=>{var l;return null===(l=e.perms)||void 0===l?void 0:l.join(",")})).join(",");return(a,v)=>{const b=o("el-checkbox"),f=o("el-tree"),y=o("el-tab-pane"),g=o("el-alert"),$=o("el-switch"),_=o("el-form-item"),w=o("el-option"),C=o("el-select"),I=o("el-tabs"),A=o("el-form"),D=o("el-tag"),O=o("el-button"),G=o("el-drawer");return t(),u(G,{title:a.$t("permissionSettings"),"with-header":!1,"model-value":e.modelValue,"onUpdate:modelValue":v[21]||(v[21]=e=>a.$emit("update:modelValue",e)),size:576},{default:n((()=>[d(A,{ref_key:"form",ref:x,model:j.value,disabled:s(ee),"label-width":"150px"},{default:n((()=>[d(I,{modelValue:U.value,"onUpdate:modelValue":v[18]||(v[18]=e=>U.value=e)},{default:n((()=>[d(y,{label:a.$t("role.permission"),name:"permission"},{default:n((()=>[k("div",null,[d(b,{modelValue:S.value,"onUpdate:modelValue":v[0]||(v[0]=e=>S.value=e),onChange:v[1]||(v[1]=e=>le(e,F.value,s(K))),disabled:!1,label:a.$t("expand/collapse")},null,8,["modelValue","label"]),d(b,{modelValue:z.value,"onUpdate:modelValue":v[2]||(v[2]=e=>z.value=e),onChange:v[3]||(v[3]=e=>{ae(e,F.value,s(K)),oe()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),d(f,{ref_key:"permissionTree",ref:F,data:s(K),"node-key":"key",onCheck:v[4]||(v[4]=e=>oe()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])])),_:1},8,["label"]),d(y,{label:a.$t("role.grantPermission"),name:"grantPermission"},{default:n((()=>[d(g,{title:a.$t("role.grantPermission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),k("div",null,[d(b,{modelValue:R.value,"onUpdate:modelValue":v[5]||(v[5]=e=>R.value=e),onChange:v[6]||(v[6]=e=>le(e,E.value,s(K))),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),d(b,{modelValue:Q.value,"onUpdate:modelValue":v[7]||(v[7]=e=>Q.value=e),onChange:v[8]||(v[8]=e=>{ae(e,E.value,s(K)),te()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),d(f,{ref_key:"grantPermissionTree",ref:E,data:s(K),"node-key":"key",onCheck:v[9]||(v[9]=e=>te()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])])),_:1},8,["label"]),d(y,{label:a.$t("role.dataPermission"),name:"dataPermission"},{default:n((()=>[d(_,{prop:"globalPermission",rules:{required:!0,message:()=>a.$t("v.required")}},{label:n((()=>[d(L,{message:"role.globalPermission",help:""})])),default:n((()=>[d($,{modelValue:j.value.globalPermission,"onUpdate:modelValue":v[10]||(v[10]=e=>j.value.globalPermission=e),disabled:!s(P).globalPermission},null,8,["modelValue","disabled"])])),_:1},8,["rules"]),d(_,{prop:"dataScope",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:n((()=>[d(L,{message:"role.dataScope",help:""})])),default:n((()=>[d(C,{modelValue:j.value.dataScope,"onUpdate:modelValue":v[11]||(v[11]=e=>j.value.dataScope=e)},{default:n((()=>[(t(),i(m,null,r([1,2,3],(e=>d(w,{key:e,label:a.$t(`role.dataScope.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["label"]),d(y,{label:a.$t("role.articlePermission"),name:"articlePermission"},{default:n((()=>[d(_,{prop:"allArticlePermission",rules:{required:!0,message:()=>a.$t("v.required")}},{label:n((()=>[d(L,{message:"role.allArticlePermission",help:""})])),default:n((()=>[d($,{modelValue:j.value.allArticlePermission,"onUpdate:modelValue":v[12]||(v[12]=e=>j.value.allArticlePermission=e)},null,8,["modelValue"])])),_:1},8,["rules"]),j.value.allArticlePermission?V("",!0):(t(),i(m,{key:0},[k("div",Y,[d(b,{modelValue:M.value,"onUpdate:modelValue":v[13]||(v[13]=e=>M.value=e),onChange:v[14]||(v[14]=e=>le(e,H.value,X.value,"id")),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),d(b,{modelValue:T.value,"onUpdate:modelValue":v[15]||(v[15]=e=>T.value=e),onChange:v[16]||(v[16]=e=>{ae(e,H.value,X.value,"id"),ue()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),d(f,{ref_key:"articlePermissionTree",ref:H,data:X.value,"node-key":"id",onCheck:v[17]||(v[17]=e=>ue()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["model","disabled"])])),footer:n((()=>[k("div",Z,[k("div",null,[d(D,null,{default:n((()=>{var e;return[c(p(null===(e=j.value)||void 0===e?void 0:e.name),1)]})),_:1})]),k("div",null,[d(O,{onClick:v[19]||(v[19]=e=>a.$emit("update:modelValue",!1))},{default:n((()=>[c(p(a.$t("cancel")),1)])),_:1}),d(O,{type:"primary",onClick:v[20]||(v[20]=e=>{x.value.validate((async e=>{if(e){B.value=!0;try{await N(j.value),l("finished"),l("update:modelValue",!1),h.success(q("success"))}finally{B.value=!1}}}))}),loading:B.value,disabled:s(ee)},{default:n((()=>[c(p(a.$t("submit")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["title","model-value"])}}}),le={class:"mb-3"};e("default",l({name:"RoleList",setup(e){const{t:l}=b(),r=a({}),m=a(),v=a(),y=a([]),V=a([]),j=a(!1),A=a(!1),B=a(!1),S=a(),N=f((()=>y.value.map((e=>e.id)))),D=a(!1),K=async()=>{j.value=!0;try{y.value=await F({...U(r.value),Q_OrderBy:m.value}),D.value=Object.values(r.value).filter((e=>void 0!==e&&""!==e)).length>0||void 0!==m.value}finally{j.value=!1}};g(K);const L=e=>e.global&&!P.globalPermission||P.rank>e.rank,O=({column:e,prop:l,order:a})=>{var o;m.value=l?(null!==(o=e.sortBy)&&void 0!==o?o:l)+("descending"===a?"_desc":""):void 0,K()},G=()=>K(),J=()=>{v.value.clearSort(),x(r.value),m.value=void 0,K()},W=()=>{S.value=void 0,A.value=!0},Y=e=>{S.value=e,A.value=!0},Z=async e=>{await z(e),K(),h.success(l("success"))};return(e,l)=>{const a=o("el-button"),m=o("el-popconfirm"),b=o("el-table-column"),f=o("el-tag"),g=o("el-table"),h=$("loading");return t(),i("div",null,[k("div",le,[d(s(Q),{params:r.value,onSearch:G,onReset:J},{default:n((()=>[d(s(M),{label:e.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),d(s(M),{label:e.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])])),_:1},8,["params"])]),k("div",null,[d(a,{type:"primary",icon:s(_),onClick:W},{default:n((()=>[c(p(e.$t("add")),1)])),_:1},8,["icon"]),d(m,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=e=>Z(V.value.map((e=>e.id))))},{reference:n((()=>[d(a,{disabled:V.value.length<=0,icon:s(C)},{default:n((()=>[c(p(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),d(H,{class:"ml-2",disabled:V.value.length<=0||D.value||s(q)("role:update"),onMove:l[1]||(l[1]=e=>(async(e,l)=>{const a=I(e,y.value,l);await R(a.map((e=>e.id)))})(V.value,e))},null,8,["disabled"]),d(s(E),{name:"role",class:"ml-2"})]),w((t(),u(g,{ref_key:"table",ref:v,data:y.value,onSelectionChange:l[2]||(l[2]=e=>V.value=e),onRowDblclick:l[3]||(l[3]=e=>Y(e.id)),onSortChange:O,class:"mt-3 shadow bg-white"},{default:n((()=>[d(s(T),{name:"role"},{default:n((()=>[d(b,{type:"selection",selectable:e=>!L(e),width:"50"},null,8,["selectable"]),d(b,{property:"id",label:"ID",width:"64",sortable:"custom"}),d(b,{property:"name",label:e.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),d(b,{property:"description",label:e.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),d(b,{property:"rank",label:e.$t("role.rank"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),d(b,{property:"globalPermission",label:e.$t("role.globalPermission"),sortable:"custom"},{default:n((({row:l})=>[d(f,{type:l.globalPermission?"success":"info",size:"small"},{default:n((()=>[c(p(e.$t(l.globalPermission?"yes":"no")),1)])),_:2},1032,["type"])])),_:1},8,["label"]),d(b,{property:"type",label:e.$t("role.type"),sortable:"custom"},{default:n((({row:l})=>[1===l.type?(t(),u(f,{key:0,size:"small"},{default:n((()=>[c(p(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):2===l.type?(t(),u(f,{key:1,type:"warning",size:"small"},{default:n((()=>[c(p(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):3===l.type?(t(),u(f,{key:2,type:"success",size:"small"},{default:n((()=>[c(p(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):(t(),u(f,{key:3,type:"info",size:"small"},{default:n((()=>[c(p(e.$t(`role.type.${l.type}`)),1)])),_:2},1024))])),_:1},8,["label"]),d(b,{property:"scope",label:e.$t("role.scope"),sortable:"custom"},{default:n((({row:l})=>[2===l.scope?(t(),u(f,{key:0,type:"success",size:"small"},{default:n((()=>[c(p(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024)):(t(),u(f,{key:1,type:"info",size:"small"},{default:n((()=>[c(p(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024))])),_:1},8,["label"]),d(b,{label:e.$t("table.action")},{default:n((({row:l})=>[d(a,{type:"primary",onClick:e=>Y(l.id),disabled:s(q)("role:update"),size:"small",link:""},{default:n((()=>[c(p(e.$t("edit")),1)])),_:2},1032,["onClick","disabled"]),d(a,{type:"primary",onClick:e=>{return a=l.id,S.value=a,void(B.value=!0);var a},disabled:s(q)("role:updatePermission"),size:"small",link:""},{default:n((()=>[c(p(e.$t("permissionSettings")),1)])),_:2},1032,["onClick","disabled"]),d(m,{title:e.$t("confirmDelete"),onConfirm:e=>Z([l.id])},{reference:n((()=>[d(a,{type:"primary",size:"small",disabled:L(l),link:""},{default:n((()=>[c(p(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data"])),[[h,j.value]]),d(X,{modelValue:A.value,"onUpdate:modelValue":l[4]||(l[4]=e=>A.value=e),beanId:S.value,beanIds:s(N),onFinished:K},null,8,["modelValue","beanId","beanIds"]),d(ee,{modelValue:B.value,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value=e),beanId:S.value,onFinished:K},null,8,["modelValue","beanId"])])}}}))}}}));
