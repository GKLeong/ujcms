import{a as P}from"./config-e88c2eae.js";import{n as Q,t as Y,v as x,m as _}from"./content-57570363.js";import{a as ee,_ as le}from"./DialogForm.vue_vue_type_script_setup_true_lang-84cdaac8.js";import{a as X}from"./BaseUpload.vue_vue_type_style_index_0_scoped_5165bd65_lang-452c0238.js";import{d as G,p as J,r as I,v as te,a as k,c as i,e as b,w as d,h as o,k as T,t as K,I as h,a8 as O,a7 as L,j as Z,Z as ae,X as ue,o as oe,g as v,i as u}from"./index-07310ff6.js";import{B as de}from"./BaseUpload-96a78565.js";const re=["onClick"],ne=["src"],ie=G({__name:"ImageExtractor",props:{modelValue:{type:Boolean,required:!0},urls:{type:Array,default:[]},min:{type:Number,default:1},max:{type:Number,default:1},appendToBody:{type:Boolean}},emits:["update:modelValue","finished"],setup(s,{emit:U}){const V=s,{urls:y,max:w,modelValue:t}=J(V),f=I();te(t,()=>{t.value&&(f.value=ee.uniq(y.value).map(l=>({url:l,checked:!1})))});const r=l=>{if(l.checked){l.checked=!l.checked;return}let e=0;f.value.forEach(g=>{g.checked&&(e+=1),e>=w.value&&(g.checked=!1)}),l.checked=!0},$=()=>{U("finished",f.value.filter(l=>l.checked).map(l=>l.url)),U("update:modelValue",!1)};return(l,e)=>{const g=k("el-col"),C=k("el-row"),m=k("el-button"),c=k("el-dialog");return i(),b(c,{"model-value":s.modelValue,"onUpdate:modelValue":e[1]||(e[1]=p=>l.$emit("update:modelValue",p)),title:l.$t("article.extractImage"),width:768,"append-to-body":s.appendToBody},{footer:d(()=>[o(m,{type:"primary",onClick:e[0]||(e[0]=p=>$()),disabled:f.value.filter(p=>p.checked).length<s.min},{default:d(()=>[T(K(l.$t("ok")),1)]),_:1},8,["disabled"])]),default:d(()=>[o(C,{gutter:16},{default:d(()=>[(i(!0),h(L,null,O(f.value,(p,N)=>(i(),b(g,{src:p,key:p.url,span:8,class:"mt-2"},{default:d(()=>[Z("div",{class:ae(["p-1 border-2 rounded cursor-pointer text-center",{"border-primary":p.checked,"border-2":p.checked}]),onClick:R=>r(p)},[Z("img",{src:p.url,class:"max-h-36 inline"},null,8,ne)],10,re)]),_:2},1032,["src"]))),128))]),_:1})]),_:1},8,["model-value","title","append-to-body"])}}}),se={name:"BlockItemForm"},ce=G({...se,props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0},blockId:{type:Number},articleId:{type:Number},title:{type:String},description:{type:String},video:{type:String},images:{type:Array,default:[]}},emits:{"update:modelValue":null,finished:null},setup(s){const U=s,{blockId:V}=J(U),y=I(),w=I(),t=I({}),f=I([]),r=ue(()=>f.value.find(l=>{var e;return l.id===((e=y.value)!=null?e:V==null?void 0:V.value)}));oe(async()=>{f.value=await P()});const $=I(!1);return(l,e)=>{var R;const g=k("el-option"),C=k("el-select"),m=k("el-form-item"),c=k("el-input"),p=k("el-button"),N=k("el-switch");return i(),h("div",null,[o(le,{name:l.$t("menu.content.blockItem"),queryBean:u(Q),createBean:u(Y),updateBean:u(x),deleteBean:u(_),beanId:s.beanId,beanIds:s.beanIds,focus:w.value,initValues:()=>({blockId:u(V),articleId:s.articleId,title:s.title,description:s.description,video:s.video}),toValues:n=>{var q,B;return{...n,articleTitle:(q=n.article)==null?void 0:q.title,articleId:(B=n.article)==null?void 0:B.id}},addable:(R=u(r))==null?void 0:R.enabled,perms:"blockItem",values:t.value,"onUpdate:values":e[14]||(e[14]=n=>t.value=n),"model-value":s.modelValue,"onUpdate:modelValue":e[15]||(e[15]=n=>l.$emit("update:modelValue",n)),onFinished:e[16]||(e[16]=n=>l.$emit("finished")),onBeanChange:e[17]||(e[17]=n=>y.value=n.blockId)},{default:d(({isEdit:n})=>{var q,B,S,F,A,D,E,H,M,W,j,z;return[o(m,{prop:"blockId",label:l.$t("blockItem.block"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(C,{modelValue:t.value.blockId,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.blockId=a),class:"w-full",onChange:e[1]||(e[1]=a=>y.value=a),disabled:""},{default:d(()=>[(i(!0),h(L,null,O(f.value,a=>(i(),h(L,{key:a.id},[n||a.enabled?(i(),b(g,{key:0,label:a.name,value:a.id,disabled:!a.enabled},null,8,["label","value","disabled"])):v("",!0)],64))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label","rules"]),n&&t.value.articleId!=null?(i(),b(m,{key:0,label:l.$t("blockItem.articleId")},{default:d(()=>[o(c,{modelValue:t.value.articleId,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.articleId=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):v("",!0),n&&t.value.articleTitle!=null?(i(),b(m,{key:1,label:l.$t("blockItem.articleTitle")},{default:d(()=>[o(c,{modelValue:t.value.articleTitle,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.articleTitle=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):v("",!0),o(m,{prop:"title",label:l.$t("blockItem.title"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:t.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.title=a),ref_key:"focus",ref:w,maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"]),t.value.articleId==null&&((q=u(r))!=null&&q.withLinkUrl)?(i(),b(m,{key:2,prop:"linkUrl",label:l.$t("blockItem.linkUrl"),rules:(B=u(r))!=null&&B.linkUrlRequired?[{required:!0,message:()=>l.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>l.$t("blockItem.error.linkUrl")}]:{pattern:/^(http|\/).*$/,message:()=>l.$t("blockItem.error.linkUrl")}},{default:d(()=>[o(c,{modelValue:t.value.linkUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.linkUrl=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(S=u(r))!=null&&S.withSubtitle?(i(),b(m,{key:3,prop:"subtitle",label:l.$t("blockItem.subtitle"),rules:{required:(F=u(r))==null?void 0:F.subtitleRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:t.value.subtitle,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.subtitle=a),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(A=u(r))!=null&&A.withDescription?(i(),b(m,{key:4,prop:"description",label:l.$t("blockItem.description"),rules:{required:(D=u(r))==null?void 0:D.descriptionRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:t.value.description,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.description=a),type:"textarea",rows:5,maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(E=u(r))!=null&&E.withImage?(i(),b(m,{key:5,prop:"image",label:l.$t("blockItem.image"),rules:{required:(H=u(r))==null?void 0:H.imageRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(u(X),{modelValue:t.value.image,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.image=a),width:u(r).imageWidth,height:u(r).imageHeight,mode:"manual"},null,8,["modelValue","width","height"]),s.images.length>0?(i(),b(p,{key:0,class:"ml-2 self-start",onClick:e[9]||(e[9]=a=>$.value=!0)},{default:d(()=>[T(K(l.$t("article.extractImage")),1)]),_:1})):v("",!0)]),_:1},8,["label","rules"])):v("",!0),(M=u(r))!=null&&M.withMobileImage?(i(),b(m,{key:6,prop:"mobileImage",label:l.$t("blockItem.mobileImage"),rules:{required:(W=u(r))==null?void 0:W.mobileImageRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(u(X),{modelValue:t.value.mobileImage,"onUpdate:modelValue":e[10]||(e[10]=a=>t.value.mobileImage=a),width:u(r).mobileImageWidth,height:u(r).mobileImageHeight,mode:"manual"},null,8,["modelValue","width","height"])]),_:1},8,["label","rules"])):v("",!0),(j=u(r))!=null&&j.withVideo?(i(),b(m,{key:7,prop:"video",label:l.$t("blockItem.video"),rules:{required:(z=u(r))==null?void 0:z.videoRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:t.value.video,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.video=a),maxlength:"255"},{prepend:d(()=>[T("URL")]),_:1},8,["modelValue"]),o(u(de),{type:"video","on-success":a=>t.value.video=a.url},null,8,["on-success"])]),_:1},8,["label","rules"])):v("",!0),o(m,{prop:"targetBlank",label:l.$t("blockItem.targetBlank"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(N,{modelValue:t.value.targetBlank,"onUpdate:modelValue":e[12]||(e[12]=a=>t.value.targetBlank=a)},null,8,["modelValue"])]),_:1},8,["label","rules"]),o(m,{prop:"enabled",label:l.$t("blockItem.enabled"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(N,{modelValue:t.value.enabled,"onUpdate:modelValue":e[13]||(e[13]=a=>t.value.enabled=a)},null,8,["modelValue"])]),_:1},8,["label","rules"])]}),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","addable","values","model-value"]),o(ie,{modelValue:$.value,"onUpdate:modelValue":e[18]||(e[18]=n=>$.value=n),urls:s.images,"append-to-body":!0,onFinished:e[19]||(e[19]=n=>t.value.image=n[0])},null,8,["modelValue","urls"])])}}});export{ie as _,ce as a};
