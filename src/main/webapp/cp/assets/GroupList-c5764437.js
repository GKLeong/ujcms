import{d as Q,r as d,a as v,c as B,e as R,w as t,i as u,h as l,I as H,a8 as se,a7 as X,p as te,u as J,X as W,v as oe,o as Y,j as I,g as Z,k as P,t as C,V as S,E as x,b as ne,f as ue,aD as ie,aI as re,cw as de,as as D,a4 as me,a1 as pe}from"./index-6c60ffba.js";import{C as ee,D as ce,E as ve,F as le,G as fe,H as be,f as _e,I as ge}from"./user-602b45f1.js";import{a as K,_ as ye,b as $e,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-b16aac13.js";import{_ as ke}from"./ListMove.vue_vue_type_script_setup_true_lang-abbfedd1.js";import{_ as he}from"./DialogForm.vue_vue_type_script_setup_true_lang-e536e4f0.js";import{_ as ae}from"./LabelTip.vue_vue_type_script_setup_true_lang-b8070de6.js";import{t as Pe}from"./tree-7e647485.js";import{f as Ce}from"./content-6884eca6.js";const we={name:"GroupForm"},Ae=Q({...we,props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(w){const A=d(),c=d({});return(o,m)=>{const $=v("el-input"),_=v("el-form-item"),V=v("el-switch"),b=v("el-option"),k=v("el-select");return B(),R(he,{name:o.$t("menu.user.group"),queryBean:u(ee),createBean:u(ce),updateBean:u(ve),deleteBean:u(le),beanId:w.beanId,beanIds:w.beanIds,focus:A.value,initValues:()=>({type:2,allAccessPermission:!0}),toValues:a=>({...a}),disableDelete:a=>a.id<=10,perms:"group",values:c.value,"onUpdate:values":m[4]||(m[4]=a=>c.value=a),"model-value":w.modelValue,"onUpdate:modelValue":m[5]||(m[5]=a=>o.$emit("update:modelValue",a)),onFinished:m[6]||(m[6]=a=>o.$emit("finished"))},{default:t(({})=>[l(_,{prop:"name",label:o.$t("group.name"),rules:{required:!0,message:()=>o.$t("v.required")}},{default:t(()=>[l($,{modelValue:c.value.name,"onUpdate:modelValue":m[0]||(m[0]=a=>c.value.name=a),ref_key:"focus",ref:A,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(_,{prop:"description",label:o.$t("group.description")},{default:t(()=>[l($,{modelValue:c.value.description,"onUpdate:modelValue":m[1]||(m[1]=a=>c.value.description=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{prop:"allAccessPermission"},{label:t(()=>[l(ae,{message:"group.allAccessPermission"})]),default:t(()=>[l(V,{modelValue:c.value.allAccessPermission,"onUpdate:modelValue":m[2]||(m[2]=a=>c.value.allAccessPermission=a)},null,8,["modelValue"])]),_:1}),l(_,{prop:"type",label:o.$t("group.type"),rules:{required:!0,message:()=>o.$t("v.required")}},{default:t(()=>[l(k,{modelValue:c.value.type,"onUpdate:modelValue":m[3]||(m[3]=a=>c.value.type=a),disabled:c.value.type===1},{default:t(()=>[(B(),H(X,null,se([1,2],a=>l(b,{key:a,disabled:a===1,label:o.$t(`group.type.${a}`),value:a},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","values","model-value"])}}}),Ie={class:"border-t"},Be={class:"flex justify-between items-center"},De={name:"UserPermissionForm"},Ue=Q({...De,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(w,{emit:A}){const c=w,{beanId:o,modelValue:m}=te(c),{t:$}=J(),_=d(),V=d({}),b=d({}),k=d(!1),a=d(!0),E=d(!1),y=d(),g=d([]);d([]);const F=W(()=>S.rank>V.value.rank),L=async()=>{(o==null?void 0:o.value)!=null&&(V.value=await ee(o.value),b.value={...V.value})},T=async()=>{g.value=Pe(await Ce())},z=async()=>{(o==null?void 0:o.value)!=null&&(await be(o.value)).forEach(e=>{var s;(s=y.value)==null||s.setChecked(e,!0,!1)})};oe(m,()=>{m.value&&(L(),z())}),Y(()=>{T()});const U=(p,e,s,i)=>{s.forEach(f=>{f.children&&(e.getNode(f[i!=null?i:"key"]).expanded=p,U(p,e,f.children,i))})},j=(p,e,s,i)=>{e.setCheckedKeys(p?s.map(f=>f[i!=null?i:"key"]):[])},q=()=>{_.value.validate(async p=>{if(p){k.value=!0;try{await fe(b.value),A("finished"),A("update:modelValue",!1),x.success($("success"))}finally{k.value=!1}}})},G=()=>{y.value!=null&&(b.value.accessPermissions=[...y.value.getCheckedNodes(),...y.value.getHalfCheckedNodes()].map(p=>p.id))};return(p,e)=>{const s=v("el-switch"),i=v("el-form-item"),f=v("el-checkbox"),h=v("el-tree"),M=v("el-form"),O=v("el-tag"),N=v("el-button"),n=v("el-drawer");return B(),R(n,{title:p.$t("permissionSettings"),"model-value":w.modelValue,"onUpdate:modelValue":e[8]||(e[8]=r=>p.$emit("update:modelValue",r)),size:414},{default:t(()=>[l(M,{ref_key:"form",ref:_,model:b.value,disabled:u(F),"label-width":"150px"},{default:t(()=>[l(i,{prop:"allAccessPermission"},{label:t(()=>[l(ae,{message:"group.allAccessPermission",help:""})]),default:t(()=>[l(s,{modelValue:b.value.allAccessPermission,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value.allAccessPermission=r)},null,8,["modelValue"])]),_:1}),b.value.allAccessPermission?Z("",!0):(B(),H(X,{key:0},[I("div",Ie,[l(f,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value=r),onChange:e[2]||(e[2]=r=>U(r,y.value,g.value,"id")),label:p.$t("expand/collapse")},null,8,["modelValue","label"]),l(f,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=r=>E.value=r),onChange:e[4]||(e[4]=r=>{j(r,y.value,g.value,"id"),G()}),label:p.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),l(h,{ref_key:"accessPermissionTree",ref:y,data:g.value,"node-key":"id",onCheck:e[5]||(e[5]=r=>G()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:t(()=>[I("div",Be,[I("div",null,[l(O,null,{default:t(()=>{var r;return[P(C((r=b.value)==null?void 0:r.name),1)]}),_:1})]),I("div",null,[l(N,{onClick:e[6]||(e[6]=r=>p.$emit("update:modelValue",!1))},{default:t(()=>[P(C(p.$t("cancel")),1)]),_:1}),l(N,{type:"primary",onClick:e[7]||(e[7]=r=>q()),loading:k.value,disabled:u(F)},{default:t(()=>[P(C(p.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),qe={class:"mb-3"},Ge={class:"app-block mt-3"},Se={name:"GroupList"},Me=Q({...Se,setup(w){const{t:A}=J(),c=d({}),o=d(),m=d(),$=d([]),_=d([]),V=d(!1),b=d(!1),k=d(!1),a=d(),E=W(()=>$.value.map(e=>e.id)),y=d(!1),g=async()=>{V.value=!0;try{$.value=await _e({...ie(c.value),Q_OrderBy:o.value}),y.value=Object.values(c.value).filter(e=>e!==void 0&&e!=="").length>0||o.value!==void 0}finally{V.value=!1}};Y(g);const F=({column:e,prop:s,order:i})=>{var f;s?o.value=((f=e.sortBy)!=null?f:s)+(i==="descending"?"_desc":""):o.value=void 0,g()},L=()=>g(),T=()=>{m.value.clearSort(),re(c.value),o.value=void 0,g()},z=()=>{a.value=void 0,b.value=!0},U=e=>{a.value=e,b.value=!0},j=e=>{a.value=e,k.value=!0},q=e=>e>10,G=async e=>{const s=e.filter(i=>q(i));s.length>0&&(await le(s),g(),x.success(A("success")))},p=async(e,s)=>{const i=de(e,$.value,s);await ge(i.map(f=>f.id))};return(e,s)=>{const i=v("el-button"),f=v("el-popconfirm"),h=v("el-table-column"),M=v("el-tag"),O=v("el-table"),N=ne("loading");return B(),H("div",null,[I("div",qe,[l(u(ye),{params:c.value,onSearch:L,onReset:T},{default:t(()=>[l(u(K),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),l(u(K),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),I("div",null,[l(i,{type:"primary",disabled:u(D)("group:create"),icon:u(me),onClick:z},{default:t(()=>[P(C(e.$t("add")),1)]),_:1},8,["disabled","icon"]),l(f,{title:e.$t("confirmDelete"),onConfirm:s[0]||(s[0]=n=>G(_.value.map(r=>r.id)))},{reference:t(()=>[l(i,{disabled:_.value.filter(n=>q(n.id)).length<=0||u(D)("group:delete"),icon:u(pe)},{default:t(()=>[P(C(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ke,{class:"ml-2",disabled:_.value.length<=0||y.value||u(D)("org:update"),onMove:s[1]||(s[1]=n=>p(_.value,n))},null,8,["disabled"]),l(u($e),{name:"group",class:"ml-2"})]),I("div",Ge,[ue((B(),R(O,{ref_key:"table",ref:m,data:$.value,onSelectionChange:s[2]||(s[2]=n=>_.value=n),onRowDblclick:s[3]||(s[3]=n=>U(n.id)),onSortChange:F},{default:t(()=>[l(u(Ve),{name:"group"},{default:t(()=>[l(h,{type:"selection",width:"50"}),l(h,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(h,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:t(({row:n})=>[l(M,{type:n.allAccessPermission?"success":"info",size:"small"},{default:t(()=>[P(C(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(h,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t(`group.type.${n.type}`)},null,8,["label","formatter"]),l(h,{label:e.$t("table.action")},{default:t(({row:n})=>[l(i,{type:"primary",disabled:u(D)("group:update"),onClick:r=>U(n.id),size:"small",link:""},{default:t(()=>[P(C(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),u(S).epRank>0||u(S).epDisplay?(B(),R(i,{key:0,type:"primary",onClick:r=>j(n.id),disabled:u(D)("group:updatePermission")||u(S).epRank<=0,title:u(S).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:""},{default:t(()=>[P(C(e.$t("permissionSettings")),1)]),_:2},1032,["onClick","disabled","title"])):Z("",!0),l(f,{title:e.$t("confirmDelete"),onConfirm:r=>G([n.id])},{reference:t(()=>[l(i,{type:"primary",disabled:!q(n.id)||u(D)("group:delete"),size:"small",link:""},{default:t(()=>[P(C(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[N,V.value]])]),l(Ae,{modelValue:b.value,"onUpdate:modelValue":s[4]||(s[4]=n=>b.value=n),beanId:a.value,beanIds:u(E),onFinished:g},null,8,["modelValue","beanId","beanIds"]),l(Ue,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=n=>k.value=n),beanId:a.value,onFinished:g},null,8,["modelValue","beanId"])])}}});export{Me as default};
