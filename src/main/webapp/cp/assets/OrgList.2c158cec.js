var x=Object.defineProperty,ee=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var T=(d,p,u)=>p in d?x(d,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[p]=u,U=(d,p)=>{for(var u in p||(p={}))ae.call(p,u)&&T(d,u,p[u]);if(F)for(var u of F(p))te.call(p,u)&&T(d,u,p[u]);return d},Q=(d,p)=>ee(d,le(p));import{p as R,c as oe,t as ne,r as se,m as de}from"./index.53bc5a6e.js";import{g as H,t as re,I as v,R as ue,j as w,o as S,k as L,w as r,l,x as J,m as s,u as ie,i as me,M as pe,N as ve,q as ce,y as E,ao as fe,O as be,Q as ge,P as B,A as D,an as ye}from"./vendor.3651bf9f.js";import{v as $e,w as Ve,x as he,y as K,q as W,z as we}from"./user.7976785a.js";import{a as Ie,b as _e,_ as G,c as ke}from"./QueryItem.794d4c55.js";import{_ as Ce}from"./ListMove.4ebc00e9.js";import{d as Be,t as De}from"./tree.4a0f1dfa.js";import{_ as qe}from"./DialogForm.3aeea6b8.js";const Oe={name:"OrgForm"},Ue=H(Q(U({},Oe),{props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(d,{emit:p}){const u=d,{showGlobalData:I,modelValue:C}=re(u),y=v(),t=v({}),$=v([]),h=async i=>{$.value=Be(De(await W({current:!I.value})),i==null?void 0:i.id)},q=async i=>{await h(i),p("finished")};return ue(C,()=>{C.value&&h()}),(i,m)=>{const O=w("el-tree-select"),b=w("el-form-item"),c=w("el-input");return S(),L(qe,{name:i.$t("menu.user.org"),queryBean:s($e),createBean:s(Ve),updateBean:s(he),deleteBean:s(K),beanId:d.beanId,beanIds:d.beanIds,focus:y.value,initValues:o=>{var g;return{parentId:(o==null?void 0:o.id)!==d.parentId&&(g=o==null?void 0:o.parentId)!=null?g:d.parentId}},toValues:o=>U({},o),disableDelete:o=>{var g;return o.id<=1||o.id===((g=$.value[0])==null?void 0:g.id)},perms:"org",values:t.value,"onUpdate:values":m[5]||(m[5]=o=>t.value=o),"model-value":d.modelValue,"onUpdate:modelValue":m[6]||(m[6]=o=>i.$emit("update:modelValue",o)),onFinished:q,onBeanChange:h},{default:r(({isEdit:o})=>{var g;return[!o||t.value.id!==((g=$.value[0])==null?void 0:g.id)?(S(),L(b,{key:0,prop:"parentId",label:i.$t("org.parent"),rules:{required:!0,message:()=>i.$t("v.required")}},{default:r(()=>[l(O,{modelValue:t.value.parentId,"onUpdate:modelValue":m[0]||(m[0]=f=>t.value.parentId=f),data:$.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":$.value.map(f=>f.id),"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])]),_:1},8,["label","rules"])):J("",!0),l(b,{prop:"name",label:i.$t("org.name"),rules:{required:!0,message:()=>i.$t("v.required")}},{default:r(()=>[l(c,{modelValue:t.value.name,"onUpdate:modelValue":m[1]||(m[1]=f=>t.value.name=f),ref_key:"focus",ref:y,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(b,{prop:"address",label:i.$t("org.address")},{default:r(()=>[l(c,{modelValue:t.value.address,"onUpdate:modelValue":m[2]||(m[2]=f=>t.value.address=f),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{prop:"phone",label:i.$t("org.phone")},{default:r(()=>[l(c,{modelValue:t.value.phone,"onUpdate:modelValue":m[3]||(m[3]=f=>t.value.phone=f),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{prop:"contacts",label:i.$t("org.contacts")},{default:r(()=>[l(c,{modelValue:t.value.contacts,"onUpdate:modelValue":m[4]||(m[4]=f=>t.value.contacts=f),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","values","model-value"])}}})),Se={class:"mb-3"},Ne={class:"app-block mt-3"},Qe={name:"OrgList"},Ae=H(Q(U({},Qe),{setup(d){const{t:p}=ie(),u=v({}),I=v(),C=v(),y=v([]),t=v([]),$=v(!1),h=v(!1),q=v(),i=me(()=>y.value.map(e=>e.id)),m=v(!1),O=v(1),b=v(!1),c=async()=>{var e;$.value=!0;try{y.value=await W(Q(U({},ne(u.value)),{current:!b.value,Q_OrderBy:I.value})),m.value=Object.values(u.value).filter(a=>a!==void 0&&a!=="").length>0||I.value!==void 0,O.value=(e=y.value[0])==null?void 0:e.id}finally{$.value=!1}};pe(c);const o=({column:e,prop:a,order:V})=>{var _;a?I.value=((_=e.sortBy)!=null?_:a)+(V==="descending"?"_desc":""):I.value=void 0,c()},g=()=>c(),f=()=>{C.value.clearSort(),se(u.value),I.value=void 0,c()},M=e=>{q.value=void 0,e!=null&&(O.value=e),h.value=!0},P=e=>{q.value=e,h.value=!0},j=async e=>{await K(e),c(),ge.success(p("success"))},A=e=>e.id>1,X=async(e,a)=>{const V=de(e,y.value,a);await we(V),await c(),e.forEach(_=>{C.value.toggleRowSelection(y.value.find(z=>z.id===_.id))})};return(e,a)=>{const V=w("el-button"),_=w("el-popconfirm"),z=w("el-checkbox"),k=w("el-table-column"),Y=w("el-table"),Z=ve("loading");return S(),ce("div",null,[E("div",Se,[l(s(Ie),{params:u.value,onSearch:g,onReset:f},{default:r(()=>[l(s(G),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),l(s(G),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),l(s(G),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),l(s(G),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),E("div",null,[l(V,{type:"primary",icon:s(fe),onClick:a[0]||(a[0]=n=>M())},{default:r(()=>[B(D(e.$t("add")),1)]),_:1},8,["icon"]),l(_,{title:e.$t("confirmDelete"),onConfirm:a[1]||(a[1]=n=>j(t.value.map(N=>N.id)))},{reference:r(()=>[l(V,{disabled:t.value.length<=0,icon:s(ye)},{default:r(()=>[B(D(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(Ce,{class:"ml-2",disabled:t.value.length<=0||m.value||s(R)("org:update"),onMove:a[2]||(a[2]=n=>X(t.value,n))},null,8,["disabled"]),s(oe).globalPermission?(S(),L(z,{key:0,class:"ml-2 align-middle",modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=n=>b.value=n),onChange:a[4]||(a[4]=n=>c()),label:e.$t("globalData"),border:""},null,8,["modelValue","label"])):J("",!0),l(s(_e),{name:"org",class:"ml-2"})]),E("div",Ne,[be((S(),L(Y,{ref_key:"table",ref:C,"row-key":"id",data:y.value,onSelectionChange:a[5]||(a[5]=n=>t.value=n),onRowDblclick:a[6]||(a[6]=n=>P(n.id)),onSortChange:o},{default:r(()=>[l(s(ke),{name:"org"},{default:r(()=>[l(k,{type:"selection",selectable:A,width:"45"}),l(k,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(k,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:r(({row:n})=>[B(D(n.names.join(" / ")),1)]),_:1},8,["label"]),l(k,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(k,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(k,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(k,{label:e.$t("table.action")},{default:r(({row:n})=>[l(V,{type:"primary",disabled:s(R)("org:create"),onClick:N=>M(n.id),size:"small",link:""},{default:r(()=>[B(D(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),l(V,{type:"primary",disabled:s(R)("org:update"),onClick:N=>P(n.id),size:"small",link:""},{default:r(()=>[B(D(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),l(_,{title:e.$t("confirmDelete"),onConfirm:N=>j([n.id])},{reference:r(()=>[l(V,{type:"primary",disabled:!A(n)||s(R)("org:delete"),size:"small",link:""},{default:r(()=>[B(D(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[Z,$.value]])]),l(Ue,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=n=>h.value=n),beanId:q.value,beanIds:s(i),onFinished:c,parentId:O.value,showGlobalData:b.value},null,8,["modelValue","beanId","beanIds","parentId","showGlobalData"])])}}}));export{Ae as default};
