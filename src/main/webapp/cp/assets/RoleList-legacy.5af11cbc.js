System.register(["./vendor-legacy.c673f215.js","./index-legacy.bb3d5eb8.js","./user-legacy.58e18ce6.js","./QueryItem-legacy.7783afb6.js","./ListMove-legacy.0c298fbd.js","./DialogForm-legacy.767cf762.js","./LabelTip-legacy.f517ffd0.js","./data-legacy.cda8ab66.js","./tree-legacy.a39fb697.js","./content-legacy.de5344a2.js"],(function(e){"use strict";var l,a,o,t,n,u,s,i,r,d,m,p,c,v,b,y,f,k,g,h,V,$,_,w,P,C,U,q,x,I,j,A,B,R,S,z,D,M,N,T,H,L,F,G,Q,E,K,O,J,W;return{setters:[function(e){l=e.g,a=e.I,o=e.j,t=e.o,n=e.k,u=e.w,s=e.l,i=e.m,r=e.q,d=e.C,m=e.F,p=e.P,c=e.A,v=e.t,b=e.u,y=e.i,f=e.R,k=e.M,g=e.y,h=e.x,V=e.Q,$=e.N,_=e.aq,w=e.O,P=e.ap},function(e){C=e.h,U=e.m,q=e.o,x=e.w,I=e.B},function(e){j=e.r,A=e.k,B=e.l,R=e.n,S=e.o,z=e.p,D=e.s,M=e.g,N=e.t},function(e){T=e.a,H=e.b,L=e._,F=e.c},function(e){G=e._},function(e){Q=e._},function(e){E=e._},function(e){K=e.b},function(e){O=e.b,J=e.t},function(e){W=e.f}],execute:function(){const X=l({name:"RoleForm",props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e){const l=a(),v=a({});return(a,b)=>{const y=o("el-input"),f=o("el-form-item"),k=o("el-input-number"),g=o("el-option"),h=o("el-select"),V=o("el-radio"),$=o("el-radio-group");return t(),n(Q,{name:a.$t("menu.user.role"),queryBean:i(A),createBean:i(B),updateBean:i(R),deleteBean:i(S),beanId:e.beanId,beanIds:e.beanIds,focus:l.value,initValues:()=>({type:4,rank:i(C).rank+1,scope:0}),toValues:e=>({...e}),disableDelete:e=>e.id<=1,disableEdit:e=>e.global&&!i(C).globalPermission||i(C).rank>e.rank,perms:"role",values:v.value,"onUpdate:values":b[5]||(b[5]=e=>v.value=e),"model-value":e.modelValue,"onUpdate:modelValue":b[6]||(b[6]=e=>a.$emit("update:modelValue",e)),onFinished:b[7]||(b[7]=e=>a.$emit("finished"))},{default:u((({bean:e,disabled:o})=>[s(f,{prop:"name",label:a.$t("role.name"),rules:{required:!0,message:()=>a.$t("v.required")}},{default:u((()=>[s(y,{modelValue:v.value.name,"onUpdate:modelValue":b[0]||(b[0]=e=>v.value.name=e),ref_key:"focus",ref:l,maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"]),s(f,{prop:"description",label:a.$t("role.description")},{default:u((()=>[s(y,{modelValue:v.value.description,"onUpdate:modelValue":b[1]||(b[1]=e=>v.value.description=e),maxlength:"300"},null,8,["modelValue"])])),_:1},8,["label"]),s(f,{prop:"rank",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:u((()=>[s(E,{message:"role.rank",help:""})])),default:u((()=>[s(k,{modelValue:v.value.rank,"onUpdate:modelValue":b[2]||(b[2]=e=>v.value.rank=e),modelModifiers:{number:!0},min:o?0:i(C).rank,max:32767},null,8,["modelValue","min"])])),_:2},1032,["rules"]),s(f,{prop:"type",rules:[{required:!0,message:()=>a.$t("v.required")},{validator:(e,l,o)=>{[1,2,3].includes(l)&&i(C).epRank<1&&o(a.$t("error.enterprise.short")),o()}}]},{label:u((()=>[s(E,{message:"role.type",help:""})])),default:u((()=>[s(h,{modelValue:v.value.type,"onUpdate:modelValue":b[3]||(b[3]=e=>v.value.type=e)},{default:u((()=>[(t(),r(m,null,d([1,2,3,4],(e=>s(g,{key:e,label:a.$t(`role.type.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"]),s(f,{prop:"scope",label:a.$t("block.scope"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(l,o,t)=>{o!==e.scope&&await i(j)(v.value.scope)&&t(a.$t("role.error.scopeNotAllowd")),t()}}]},{default:u((()=>[s($,{modelValue:v.value.scope,"onUpdate:modelValue":b[4]||(b[4]=e=>v.value.scope=e)},{default:u((()=>[(t(),r(m,null,d([0,2],(e=>s(V,{key:e,label:e,disabled:!i(C).globalPermission},{default:u((()=>[p(c(a.$t(`role.scope.${e}`)),1)])),_:2},1032,["label","disabled"]))),64))])),_:1},8,["modelValue"])])),_:2},1032,["label","rules"])])),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","disableEdit","values","model-value"])}}}),Y={class:"border-t"},Z={class:"border-t"},ee=["innerHTML"],le=["innerHTML"],ae={class:"border-t"},oe=["innerHTML"],te={class:"flex justify-between items-center"},ne=l({name:"RolePermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){var $;const _=e,{beanId:w,modelValue:P}=v(_),{t:U}=b(),q=a("permission"),x=a(),I=a({}),j=a({}),B=a(!1),R=a(!0),S=a(!1),M=a(),N=a(!0),T=a(!1),H=a(),L=a(!0),F=a(!1),G=a(),Q=K();O(Q,null!==($=C.grantPermissions)&&void 0!==$?$:[]);const X=a([]),ne=y((()=>I.value.global&&!C.globalPermission||C.rank>I.value.rank));f(P,(()=>{P.value&&((async()=>{var e,l,a,o,t,n;null!=(null==w?void 0:w.value)&&(I.value=await A(w.value),j.value={...I.value},null===(e=M.value)||void 0===e||e.setCheckedKeys(null!==(l=null===(a=I.value.permission)||void 0===a?void 0:a.split(","))&&void 0!==l?l:[]),null===(o=H.value)||void 0===o||o.setCheckedKeys(null!==(t=null===(n=I.value.grantPermission)||void 0===n?void 0:n.split(","))&&void 0!==t?t:[]))})(),(async()=>{null!=(null==w?void 0:w.value)&&(await D(w.value)).forEach((e=>{var l;null===(l=G.value)||void 0===l||l.setChecked(e,!0,!1)}))})())})),k((()=>{(async()=>{X.value=J(await W())})()}));const ue=(e,l,a,o)=>{a.forEach((a=>{a.children&&(l.getNode(a[null!=o?o:"key"]).expanded=e,ue(e,l,a.children,o))}))},se=(e,l,a,o)=>{l.setCheckedKeys(e?a.map((e=>e[null!=o?o:"key"])):[])},ie=()=>{null!=M.value&&(j.value.permission=me(M.value.getCheckedNodes(),M.value.getHalfCheckedNodes()))},re=()=>{null!=H.value&&(j.value.grantPermission=me(H.value.getCheckedNodes(),H.value.getHalfCheckedNodes()))},de=()=>{null!=G.value&&(j.value.articlePermissions=[...G.value.getCheckedNodes(),...G.value.getHalfCheckedNodes()].map((e=>e.id)))},me=(e,l)=>[...e,...l].filter((e=>e.perms)).map((e=>{var l;return null===(l=e.perms)||void 0===l?void 0:l.join(",")})).join(",");return(a,v)=>{const b=o("el-alert"),y=o("el-switch"),f=o("el-form-item"),k=o("el-checkbox"),$=o("el-tree"),_=o("el-tab-pane"),w=o("el-option"),P=o("el-select"),I=o("el-tabs"),A=o("el-form"),D=o("el-tag"),K=o("el-button"),O=o("el-drawer");return t(),n(O,{title:a.$t("permissionSettings"),"with-header":!1,"model-value":e.modelValue,"onUpdate:modelValue":v[23]||(v[23]=e=>a.$emit("update:modelValue",e)),size:576},{default:u((()=>[s(A,{ref_key:"form",ref:x,model:j.value,disabled:i(ne),"label-width":"150px"},{default:u((()=>[s(I,{modelValue:q.value,"onUpdate:modelValue":v[20]||(v[20]=e=>q.value=e)},{default:u((()=>[s(_,{label:a.$t("role.permission"),name:"permission"},{default:u((()=>[s(b,{title:a.$t("role.permission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),s(f,{prop:"allPermission"},{label:u((()=>[s(E,{message:"role.allPermission"})])),default:u((()=>[s(y,{modelValue:j.value.allPermission,"onUpdate:modelValue":v[0]||(v[0]=e=>j.value.allPermission=e)},null,8,["modelValue"])])),_:1}),j.value.allPermission?h("",!0):(t(),r(m,{key:0},[g("div",Y,[s(k,{modelValue:R.value,"onUpdate:modelValue":v[1]||(v[1]=e=>R.value=e),onChange:v[2]||(v[2]=e=>ue(e,M.value,i(Q))),disabled:!1,label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:S.value,"onUpdate:modelValue":v[3]||(v[3]=e=>S.value=e),onChange:v[4]||(v[4]=e=>{se(e,M.value,i(Q)),ie()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"permissionTree",ref:M,data:i(Q),"node-key":"key",onCheck:v[5]||(v[5]=e=>ie()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))])),_:1},8,["label"]),i(C).epRank>=1||i(C).epDisplay?(t(),n(_,{key:0,label:a.$t("role.grantPermission"),name:"grantPermission"},{default:u((()=>[i(C).epRank>=1?(t(),r(m,{key:0},[s(b,{title:a.$t("role.grantPermission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),s(f,{prop:"allGrantPermission",class:"mt-3"},{label:u((()=>[s(E,{message:"role.allGrantPermission"})])),default:u((()=>[s(y,{modelValue:j.value.allGrantPermission,"onUpdate:modelValue":v[6]||(v[6]=e=>j.value.allGrantPermission=e)},null,8,["modelValue"])])),_:1}),j.value.allGrantPermission?h("",!0):(t(),r(m,{key:0},[g("div",Z,[s(k,{modelValue:N.value,"onUpdate:modelValue":v[7]||(v[7]=e=>N.value=e),onChange:v[8]||(v[8]=e=>ue(e,H.value,i(Q))),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:T.value,"onUpdate:modelValue":v[9]||(v[9]=e=>T.value=e),onChange:v[10]||(v[10]=e=>{se(e,H.value,i(Q)),re()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"grantPermissionTree",ref:H,data:i(Q),"node-key":"key",onCheck:v[11]||(v[11]=e=>re()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,ee)])),_:1}))])),_:1},8,["label"])):h("",!0),i(C).epRank>=1||i(C).epDisplay?(t(),n(_,{key:1,label:a.$t("role.dataPermission"),name:"dataPermission"},{default:u((()=>[i(C).epRank>=1?(t(),r(m,{key:0},[s(f,{prop:"globalPermission",rules:{required:!0,message:()=>a.$t("v.required")}},{label:u((()=>[s(E,{message:"role.globalPermission",help:""})])),default:u((()=>[s(y,{modelValue:j.value.globalPermission,"onUpdate:modelValue":v[12]||(v[12]=e=>j.value.globalPermission=e),disabled:!i(C).globalPermission},null,8,["modelValue","disabled"])])),_:1},8,["rules"]),s(f,{prop:"dataScope",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:u((()=>[s(E,{message:"role.dataScope",help:""})])),default:u((()=>[s(P,{modelValue:j.value.dataScope,"onUpdate:modelValue":v[13]||(v[13]=e=>j.value.dataScope=e)},{default:u((()=>[(t(),r(m,null,d([1,2,3],(e=>s(w,{key:e,label:a.$t(`role.dataScope.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"])],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,le)])),_:1}))])),_:1},8,["label"])):h("",!0),i(C).epRank>=1||i(C).epDisplay?(t(),n(_,{key:2,label:a.$t("role.articlePermission"),name:"articlePermission"},{default:u((()=>[i(C).epRank>=1?(t(),r(m,{key:0},[s(f,{prop:"allArticlePermission"},{label:u((()=>[s(E,{message:"role.allArticlePermission",help:""})])),default:u((()=>[s(y,{modelValue:j.value.allArticlePermission,"onUpdate:modelValue":v[14]||(v[14]=e=>j.value.allArticlePermission=e)},null,8,["modelValue"])])),_:1}),j.value.allArticlePermission?h("",!0):(t(),r(m,{key:0},[g("div",ae,[s(k,{modelValue:L.value,"onUpdate:modelValue":v[15]||(v[15]=e=>L.value=e),onChange:v[16]||(v[16]=e=>ue(e,G.value,X.value,"id")),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:F.value,"onUpdate:modelValue":v[17]||(v[17]=e=>F.value=e),onChange:v[18]||(v[18]=e=>{se(e,G.value,X.value,"id"),de()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"articlePermissionTree",ref:G,data:X.value,"node-key":"id",onCheck:v[19]||(v[19]=e=>de()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,oe)])),_:1}))])),_:1},8,["label"])):h("",!0)])),_:1},8,["modelValue"])])),_:1},8,["model","disabled"])])),footer:u((()=>[g("div",te,[g("div",null,[s(D,null,{default:u((()=>{var e;return[p(c(null===(e=j.value)||void 0===e?void 0:e.name),1)]})),_:1})]),g("div",null,[s(K,{onClick:v[21]||(v[21]=e=>a.$emit("update:modelValue",!1))},{default:u((()=>[p(c(a.$t("cancel")),1)])),_:1}),s(K,{type:"primary",onClick:v[22]||(v[22]=e=>{x.value.validate((async e=>{if(e){B.value=!0;try{ie(),re(),de(),await z(j.value),l("finished"),l("update:modelValue",!1),V.success(U("success"))}finally{B.value=!1}}}))}),loading:B.value,disabled:i(ne)},{default:u((()=>[p(c(a.$t("save")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["title","model-value"])}}}),ue={class:"mb-3"};e("default",l({name:"RoleList",setup(e){const{t:l}=b(),d=a({}),m=a(),v=a(),f=a([]),h=a([]),j=a(!1),A=a(!1),B=a(!1),R=a(),z=y((()=>f.value.map((e=>e.id)))),D=a(!1),Q=async()=>{j.value=!0;try{f.value=await M({...q(d.value),Q_OrderBy:m.value}),D.value=Object.values(d.value).filter((e=>void 0!==e&&""!==e)).length>0||void 0!==m.value}finally{j.value=!1}};k(Q);const E=e=>e.global&&!C.globalPermission||C.rank>e.rank,K=({column:e,prop:l,order:a})=>{var o;m.value=l?(null!==(o=e.sortBy)&&void 0!==o?o:l)+("descending"===a?"_desc":""):void 0,Q()},O=()=>Q(),J=()=>{v.value.clearSort(),x(d.value),m.value=void 0,Q()},W=()=>{R.value=void 0,A.value=!0},Y=e=>{R.value=e,A.value=!0},Z=async e=>{await S(e),Q(),V.success(l("success"))};return(e,l)=>{const a=o("el-button"),m=o("el-popconfirm"),b=o("el-table-column"),y=o("el-tag"),k=o("el-table"),V=$("loading");return t(),r("div",null,[g("div",ue,[s(i(T),{params:d.value,onSearch:O,onReset:J},{default:u((()=>[s(i(L),{label:e.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),s(i(L),{label:e.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])])),_:1},8,["params"])]),g("div",null,[s(a,{type:"primary",icon:i(_),onClick:W},{default:u((()=>[p(c(e.$t("add")),1)])),_:1},8,["icon"]),s(m,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=e=>Z(h.value.map((e=>e.id))))},{reference:u((()=>[s(a,{disabled:h.value.length<=0,icon:i(P)},{default:u((()=>[p(c(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),s(G,{class:"ml-2",disabled:h.value.length<=0||D.value||i(U)("role:update"),onMove:l[1]||(l[1]=e=>(async(e,l)=>{const a=I(e,f.value,l);await N(a.map((e=>e.id)))})(h.value,e))},null,8,["disabled"]),s(i(H),{name:"role",class:"ml-2"})]),w((t(),n(k,{ref_key:"table",ref:v,data:f.value,onSelectionChange:l[2]||(l[2]=e=>h.value=e),onRowDblclick:l[3]||(l[3]=e=>Y(e.id)),onSortChange:K,class:"mt-3 shadow bg-white"},{default:u((()=>[s(i(F),{name:"role"},{default:u((()=>[s(b,{type:"selection",selectable:e=>!E(e),width:"50"},null,8,["selectable"]),s(b,{property:"id",label:"ID",width:"64",sortable:"custom"}),s(b,{property:"name",label:e.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"description",label:e.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"rank",label:e.$t("role.rank"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"globalPermission",label:e.$t("role.globalPermission"),sortable:"custom"},{default:u((({row:l})=>[s(y,{type:l.globalPermission?"success":"info",size:"small"},{default:u((()=>[p(c(e.$t(l.globalPermission?"yes":"no")),1)])),_:2},1032,["type"])])),_:1},8,["label"]),s(b,{property:"type",label:e.$t("role.type"),sortable:"custom"},{default:u((({row:l})=>[1===l.type?(t(),n(y,{key:0,size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):2===l.type?(t(),n(y,{key:1,type:"warning",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):3===l.type?(t(),n(y,{key:2,type:"success",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):(t(),n(y,{key:3,type:"info",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024))])),_:1},8,["label"]),s(b,{property:"scope",label:e.$t("role.scope"),sortable:"custom"},{default:u((({row:l})=>[2===l.scope?(t(),n(y,{key:0,type:"success",size:"small"},{default:u((()=>[p(c(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024)):(t(),n(y,{key:1,type:"info",size:"small"},{default:u((()=>[p(c(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024))])),_:1},8,["label"]),s(b,{label:e.$t("table.action"),width:"160"},{default:u((({row:l})=>[s(a,{type:"primary",onClick:e=>Y(l.id),disabled:i(U)("role:update"),size:"small",link:""},{default:u((()=>[p(c(e.$t("edit")),1)])),_:2},1032,["onClick","disabled"]),s(a,{type:"primary",onClick:e=>{return a=l.id,R.value=a,void(B.value=!0);var a},disabled:i(U)("role:updatePermission"),size:"small",link:""},{default:u((()=>[p(c(e.$t("permissionSettings")),1)])),_:2},1032,["onClick","disabled"]),s(m,{title:e.$t("confirmDelete"),onConfirm:e=>Z([l.id])},{reference:u((()=>[s(a,{type:"primary",size:"small",disabled:E(l),link:""},{default:u((()=>[p(c(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data"])),[[V,j.value]]),s(X,{modelValue:A.value,"onUpdate:modelValue":l[4]||(l[4]=e=>A.value=e),beanId:R.value,beanIds:i(z),onFinished:Q},null,8,["modelValue","beanId","beanIds"]),s(ne,{modelValue:B.value,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value=e),beanId:R.value,onFinished:Q},null,8,["modelValue","beanId"])])}}}))}}}));
