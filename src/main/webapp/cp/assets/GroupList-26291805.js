import{d as O,r as m,a as c,c as D,e as R,w as o,i as d,h as l,av as J,I as Q,ad as se,ac as W,p as oe,u as X,a1 as Y,v as te,o as Z,ax as E,j as U,g as x,k as C,t as P,E as ee,b as ne,f as ue,aB as ie,aH as de,aJ as re,ao as q,aa as me,a7 as pe}from"./index-0188cf50.js";import{C as le,D as ce,E as ve,F as ae,G as fe,H as be,f as _e,I as ye}from"./user-9208b250.js";import{a as K,_ as ge,b as $e,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-0e6ad83a.js";import{_ as ke}from"./ListMove.vue_vue_type_script_setup_true_lang-a1b8cb75.js";import{_ as he}from"./DialogForm.vue_vue_type_script_setup_true_lang-3a3f2920.js";import{t as Ce}from"./tree-73f11865.js";import{g as Pe}from"./content-f56c1924.js";const we={name:"GroupForm"},Ae=O({...we,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(w){const A=m(),p=m({});return(u,r)=>{const $=c("el-input"),_=c("el-form-item"),V=c("el-switch"),f=c("el-option"),k=c("el-select");return D(),R(he,{values:p.value,"onUpdate:values":r[4]||(r[4]=a=>p.value=a),name:u.$t("menu.user.group"),"query-bean":d(le),"create-bean":d(ce),"update-bean":d(ve),"delete-bean":d(ae),"bean-id":w.beanId,"bean-ids":w.beanIds,focus:A.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":a=>({...a}),"disable-delete":a=>a.id<=10,perms:"group","model-value":w.modelValue,"onUpdate:modelValue":r[5]||(r[5]=a=>u.$emit("update:modelValue",a)),onFinished:r[6]||(r[6]=()=>u.$emit("finished"))},{default:o(({})=>[l(_,{prop:"name",label:u.$t("group.name"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:o(()=>[l($,{ref_key:"focus",ref:A,modelValue:p.value.name,"onUpdate:modelValue":r[0]||(r[0]=a=>p.value.name=a),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(_,{prop:"description",label:u.$t("group.description")},{default:o(()=>[l($,{modelValue:p.value.description,"onUpdate:modelValue":r[1]||(r[1]=a=>p.value.description=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{prop:"allAccessPermission"},{label:o(()=>[l(J,{message:"group.allAccessPermission"})]),default:o(()=>[l(V,{modelValue:p.value.allAccessPermission,"onUpdate:modelValue":r[2]||(r[2]=a=>p.value.allAccessPermission=a)},null,8,["modelValue"])]),_:1}),l(_,{prop:"type",label:u.$t("group.type"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:o(()=>[l(k,{modelValue:p.value.type,"onUpdate:modelValue":r[3]||(r[3]=a=>p.value.type=a),disabled:p.value.type===1},{default:o(()=>[(D(),Q(W,null,se([1,2],a=>l(f,{key:a,disabled:a===1,label:u.$t(`group.type.${a}`),value:a},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),Ue={class:"border-t"},De={class:"flex justify-between items-center"},qe={name:"UserPermissionForm"},Ge=O({...qe,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null}},emits:{"update:modelValue":null,finished:null},setup(w,{emit:A}){const p=w,{beanId:u,modelValue:r}=oe(p),{t:$}=X(),_=m(),V=m({}),f=m({}),k=m(!1),a=m(!0),I=m(!1),g=m(),y=m([]),N=Y(()=>E.rank>V.value.rank),L=async()=>{(u==null?void 0:u.value)!=null&&(V.value=await le(u.value),f.value={...V.value})},T=async()=>{y.value=Ce(await Pe())},z=async()=>{var i;if((u==null?void 0:u.value)!=null){const e=await be(u.value);(i=g.value)==null||i.setCheckedKeys([]),e.forEach(s=>{var t;(t=g.value)==null||t.setChecked(s,!0,!1)})}};te(r,()=>{r.value&&(L(),z())}),Z(()=>{T()});const G=(i,e,s,t)=>{s.forEach(v=>{v.children&&(e.getNode(v[t!=null?t:"key"]).expanded=i,G(i,e,v.children,t))})},j=(i,e,s,t)=>{e.setCheckedKeys(i?s.map(v=>v[t!=null?t:"key"]):[])},S=()=>{_.value.validate(async i=>{if(i){k.value=!0;try{await fe(f.value),A("finished"),A("update:modelValue",!1),ee.success($("success"))}finally{k.value=!1}}})},B=()=>{g.value!=null&&(f.value.accessPermissions=[...g.value.getCheckedNodes(),...g.value.getHalfCheckedNodes()].map(i=>i.id))};return(i,e)=>{const s=c("el-switch"),t=c("el-form-item"),v=c("el-checkbox"),h=c("el-tree"),H=c("el-form"),M=c("el-tag"),F=c("el-button"),n=c("el-drawer");return D(),R(n,{title:i.$t("permissionSettings"),"model-value":w.modelValue,size:414,"onUpdate:modelValue":e[8]||(e[8]=b=>i.$emit("update:modelValue",b))},{default:o(()=>[l(H,{ref_key:"form",ref:_,model:f.value,disabled:N.value,"label-width":"150px"},{default:o(()=>[l(t,{prop:"allAccessPermission"},{label:o(()=>[l(J,{message:"group.allAccessPermission",help:""})]),default:o(()=>[l(s,{modelValue:f.value.allAccessPermission,"onUpdate:modelValue":e[0]||(e[0]=b=>f.value.allAccessPermission=b)},null,8,["modelValue"])]),_:1}),f.value.allAccessPermission?x("",!0):(D(),Q(W,{key:0},[U("div",Ue,[l(v,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=b=>a.value=b),label:i.$t("expand/collapse"),onChange:e[2]||(e[2]=b=>G(b,g.value,y.value,"id"))},null,8,["modelValue","label"]),l(v,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=b=>I.value=b),label:i.$t("checkAll/uncheckAll"),onChange:e[4]||(e[4]=b=>{j(b,g.value,y.value,"id"),B()})},null,8,["modelValue","label"])]),l(h,{ref_key:"accessPermissionTree",ref:g,data:y.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:e[5]||(e[5]=()=>B())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:o(()=>[U("div",De,[U("div",null,[l(M,null,{default:o(()=>{var b;return[C(P((b=f.value)==null?void 0:b.name),1)]}),_:1})]),U("div",null,[l(F,{onClick:e[6]||(e[6]=()=>i.$emit("update:modelValue",!1))},{default:o(()=>[C(P(i.$t("cancel")),1)]),_:1}),l(F,{type:"primary",loading:k.value,disabled:N.value,onClick:e[7]||(e[7]=()=>S())},{default:o(()=>[C(P(i.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),Se={class:"mb-3"},Be={class:"app-block mt-3"},Ee={name:"GroupList"},je=O({...Ee,setup(w){const{t:A}=X(),p=m({}),u=m(),r=m(),$=m([]),_=m([]),V=m(!1),f=m(!1),k=m(!1),a=m(),I=Y(()=>$.value.map(e=>e.id)),g=m(!1),y=async()=>{V.value=!0;try{$.value=await _e({...ie(p.value),Q_OrderBy:u.value}),g.value=Object.values(p.value).filter(e=>e!==void 0&&e!=="").length>0||u.value!==void 0}finally{V.value=!1}};Z(y);const N=({column:e,prop:s,order:t})=>{var v;s?u.value=((v=e.sortBy)!=null?v:s)+(t==="descending"?"_desc":""):u.value=void 0,y()},L=()=>y(),T=()=>{r.value.clearSort(),de(p.value),u.value=void 0,y()},z=()=>{a.value=void 0,f.value=!0},G=e=>{a.value=e,f.value=!0},j=e=>{a.value=e,k.value=!0},S=e=>e>10,B=async e=>{const s=e.filter(t=>S(t));s.length>0&&(await ae(s),y(),ee.success(A("success")))},i=async(e,s)=>{const t=re(e,$.value,s);await ye(t.map(v=>v.id))};return(e,s)=>{const t=c("el-button"),v=c("el-popconfirm"),h=c("el-table-column"),H=c("el-tag"),M=c("el-table"),F=ne("loading");return D(),Q("div",null,[U("div",Se,[l(d(ge),{params:p.value,onSearch:L,onReset:T},{default:o(()=>[l(d(K),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),l(d(K),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),U("div",null,[l(t,{type:"primary",disabled:d(q)("group:create"),icon:d(me),onClick:z},{default:o(()=>[C(P(e.$t("add")),1)]),_:1},8,["disabled","icon"]),l(v,{title:e.$t("confirmDelete"),onConfirm:s[0]||(s[0]=()=>B(_.value.map(n=>n.id)))},{reference:o(()=>[l(t,{disabled:_.value.filter(n=>S(n.id)).length<=0||d(q)("group:delete"),icon:d(pe)},{default:o(()=>[C(P(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ke,{class:"ml-2",disabled:_.value.length<=0||g.value||d(q)("org:update"),onMove:s[1]||(s[1]=n=>i(_.value,n))},null,8,["disabled"]),l(d($e),{name:"group",class:"ml-2"})]),U("div",Be,[ue((D(),R(M,{ref_key:"table",ref:r,data:$.value,onSelectionChange:s[2]||(s[2]=n=>_.value=n),onRowDblclick:s[3]||(s[3]=n=>G(n.id)),onSortChange:N},{default:o(()=>[l(d(Ve),{name:"group"},{default:o(()=>[l(h,{type:"selection",width:"50"}),l(h,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(h,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:o(({row:n})=>[l(H,{type:n.allAccessPermission?"success":"info",size:"small"},{default:o(()=>[C(P(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(h,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t(`group.type.${n.type}`)},null,8,["label","formatter"]),l(h,{label:e.$t("table.action")},{default:o(({row:n})=>[l(t,{type:"primary",disabled:d(q)("group:update"),size:"small",link:"",onClick:b=>G(n.id)},{default:o(()=>[C(P(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),d(E).epRank>0||d(E).epDisplay?(D(),R(t,{key:0,type:"primary",disabled:d(q)("group:updatePermission")||d(E).epRank<=0,title:d(E).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:"",onClick:()=>j(n.id)},{default:o(()=>[C(P(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","title","onClick"])):x("",!0),l(v,{title:e.$t("confirmDelete"),onConfirm:()=>B([n.id])},{reference:o(()=>[l(t,{type:"primary",disabled:!S(n.id)||d(q)("group:delete"),size:"small",link:""},{default:o(()=>[C(P(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[F,V.value]])]),l(Ae,{modelValue:f.value,"onUpdate:modelValue":s[4]||(s[4]=n=>f.value=n),"bean-id":a.value,"bean-ids":I.value,onFinished:y},null,8,["modelValue","bean-id","bean-ids"]),l(Ge,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=n=>k.value=n),"bean-id":a.value,onFinished:y},null,8,["modelValue","bean-id"])])}}});export{je as default};
