var ne=Object.defineProperty,ie=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var W=(g,n,p)=>n in g?ne(g,n,{enumerable:!0,configurable:!0,writable:!0,value:p}):g[n]=p,B=(g,n)=>{for(var p in n||(n={}))pe.call(n,p)&&W(g,p,n[p]);if(H)for(var p of H(n))me.call(n,p)&&W(g,p,n[p]);return g},N=(g,n)=>ie(g,de(n));import{g as J,u as j,I as l,M as Q,j as i,N as ce,o as S,k as D,w as o,O as ve,x as A,l as t,m as v,y as K,P as E,A as T,K as X,Q as Y,af as Z,D as fe,p as ge,J as he,q as ye,X as we,ag as Ve,ah as _e,e as be}from"./vendor.7e46e91a.js";import{q as ee,s as x,p as $e,a as ae,c as ke,t as le,b as te,d as Me,_ as qe,e as Ce,f as Se,l as Le}from"./index.9cf006c5.js";const Pe={name:"ChangePassword"},Ue=J(N(B({},Pe),{props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null},setup(g,{emit:n}){const{t:p}=j(),a=l({}),V=l(),h=l(),$=l(!1),_=l(!1),k=l(""),y=l();Q(async()=>{$.value=!0;try{k.value=await ee()}finally{$.value=!1}});const L=()=>{V.value.validate(async r=>{if(!!r){_.value=!0;try{const e=ae(a.value.password,k.value),u=await ke(N(B({},a.value),{password:e}));if(u.status!==0){y.value=u.message;return}y.value=void 0,V.value.resetFields(),Y.success(p("success")),n("update:modelValue",!1)}finally{_.value=!1}}})};return(r,e)=>{const u=i("el-alert"),w=i("el-input"),M=i("el-form-item"),P=i("el-button"),I=i("el-form"),b=i("el-dialog"),U=ce("loading");return S(),D(b,{title:r.$t("changePassword"),"model-value":g.modelValue,"onUpdate:modelValue":e[4]||(e[4]=m=>r.$emit("update:modelValue",m)),onOpened:e[5]||(e[5]=m=>{var c;(c=h.value)==null||c.focus(),V.value.resetFields()})},{default:o(()=>[ve((S(),D(I,{ref_key:"form",ref:V,model:a.value,"label-width":"150px","label-position":"right"},{default:o(()=>[y.value?(S(),D(u,{key:0,title:y.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):A("",!0),t(M,{prop:"username",label:r.$t("user.username"),rules:[{required:!0,message:()=>r.$t("v.required")}]},{default:o(()=>[t(w,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=m=>a.value.username=m),ref_key:"focus",ref:h,maxlength:"30"},null,8,["modelValue"])]),_:1},8,["label","rules"]),t(M,{prop:"password",label:r.$t("user.origPassword"),rules:[{required:!0,message:()=>r.$t("v.required")}]},{default:o(()=>[t(w,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=m=>a.value.password=m),maxlength:"50","show-password":""},null,8,["modelValue"])]),_:1},8,["label","rules"]),t(M,{prop:"plainPassword",label:r.$t("user.newPassword"),rules:[{required:!0,message:()=>r.$t("v.required")},{min:v(x).passwordMinLength,max:v(x).passwordMaxLength,message:()=>r.$t("user.error.passwordLength",{min:v(x).passwordMinLength,max:v(x).passwordMaxLength})},{pattern:v($e)(v(x).passwordStrength),message:()=>r.$t(`user.error.passwordPattern.${v(x).passwordStrength}`)}]},{default:o(()=>[t(w,{modelValue:a.value.plainPassword,"onUpdate:modelValue":e[2]||(e[2]=m=>a.value.plainPassword=m),maxlength:v(x).passwordMaxLength,"show-password":""},null,8,["modelValue","maxlength"])]),_:1},8,["label","rules"]),t(M,{prop:"passwordAgain",label:r.$t("user.passwordAgain"),rules:[{required:!0,message:()=>r.$t("v.required")},{validator:(m,c,q)=>{c!==a.value.plainPassword&&q(r.$t("user.error.passwordNotMatch")),q()}}]},{default:o(()=>[t(w,{modelValue:a.value.passwordAgain,"onUpdate:modelValue":e[3]||(e[3]=m=>a.value.passwordAgain=m),maxlength:"50","show-password":""},null,8,["modelValue"])]),_:1},8,["label","rules"]),K("div",null,[t(P,{loading:_.value,onClick:X(L,["prevent"]),type:"primary","native-type":"submit"},{default:o(()=>[E(T(r.$t("submit")),1)]),_:1},8,["loading","onClick"])])]),_:1},8,["model"])),[[U,$.value]])]),_:1},8,["title","model-value"])}}})),De={name:"GetShortMessage"},Ie=J(N(B({},De),{props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finish:null},setup(g,{emit:n}){const{t:p}=j(),a=l(),V=l(),h=l({}),$=l(!1),_=l(),k=l(),y=l(),L=async()=>{const{token:e,image:u}=await te();k.value="data:image/png;base64,"+u,y.value=e};Q(async()=>{L()});const r=()=>{a.value.validate(async e=>{var u;if(!!e){$.value=!0;try{const w=await Me((u=y.value)!=null?u:"",h.value.captcha,h.value.mobile);if(w.status!==0){_.value=w.message;return}_.value=void 0,a.value.resetFields(),Y.success(p("success")),n("finish",w.result.token),n("update:modelValue",!1)}finally{$.value=!1}}})};return(e,u)=>{const w=i("el-alert"),M=i("el-input"),P=i("el-form-item"),I=i("el-image"),b=i("el-button"),U=i("el-form"),m=i("el-dialog");return S(),D(m,{title:e.$t("getShortMessage"),"model-value":g.modelValue,"onUpdate:modelValue":u[3]||(u[3]=c=>e.$emit("update:modelValue",c)),onOpened:u[4]||(u[4]=c=>{var q;(q=V.value)==null||q.focus(),a.value.resetFields()}),width:"576px"},{default:o(()=>[t(U,{ref_key:"form",ref:a,model:h.value,"label-width":"150px","label-position":"right"},{default:o(()=>[_.value?(S(),D(w,{key:0,title:_.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):A("",!0),t(P,{prop:"mobile",label:e.$t("mobile"),rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:o(()=>[t(M,{modelValue:h.value.mobile,"onUpdate:modelValue":u[0]||(u[0]=c=>h.value.mobile=c),ref_key:"focus",ref:V,maxlength:"30"},null,8,["modelValue"])]),_:1},8,["label","rules"]),t(P,{prop:"captcha",label:e.$t("captcha"),rules:[{required:!0,message:()=>e.$t("v.required")},{asyncValidator:async(c,q,F)=>{(y.value==null||!await v(le)(y.value,q))&&F(e.$t("captchaIncorrect")),F()},trigger:"blur"}],class:"captcha"},{default:o(()=>[t(M,{modelValue:h.value.captcha,"onUpdate:modelValue":u[2]||(u[2]=c=>h.value.captcha=c),name:"captcha",placeholder:e.$t("captcha"),"prefix-icon":v(Z)},{append:o(()=>[t(I,{src:k.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",onClick:u[1]||(u[1]=c=>L()),title:e.$t("clickToRetrieveCaptcha")},null,8,["src","title"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label","rules"]),K("div",null,[t(b,{loading:$.value,onClick:X(r,["prevent"]),type:"primary","native-type":"submit"},{default:o(()=>[E(T(e.$t("submit")),1)]),_:1},8,["loading","onClick"])])]),_:1},8,["model"])]),_:1},8,["title","model-value"])}}}));const xe={class:"h-full p-3 bg-gray-100"},Te={class:"py-5 text-center text-3xl font-bold text-primary"},Be={class:"mt-2 text-right"},Ne=J({name:"Login",setup(g){const{t:n}=j(),p=l(),a=l({}),V=l(),h=l(!1),$=l(!1),_=l(),k=l(),y=l(),L=l(),r=l(!1),e=l(),u=fe(),w=ge(),M="UJCMS",P=l(!1),I=l(!1),b=l(60),U=l(n("getShortMessage")),m=async()=>{const{token:d,image:s}=await te();_.value="data:image/png;base64,"+s,k.value=d},c=async()=>{h.value=await Ce()},q=async()=>{$.value=await Se()};Q(async()=>{V.value.focus(),V.value.select(),m(),c(),q()}),he(()=>{e.value=u.query.redirect});const F=d=>{y.value=d,b.value-=1,U.value=String(b.value);const s=setInterval(()=>{b.value-=1,U.value=String(b.value),b.value<=0&&(U.value=n("getShortMessage"),b.value=60,clearInterval(s))},1e3)},se=()=>{p.value.validate(async d=>{if(!!d){r.value=!0;try{const s=await ee(),O=ae(a.value.password,s),C=await Le(N(B({},a.value),{password:O,captchaToken:k.value,shortMessageToken:y.value}));if(C.status!==0){c(),L.value=C.message;return}C.result.remainingDays!=null&&be.alert(n("passwordRemaingDays",{remainingDays:C.result.remainingDays}),{type:"warning"}),e.value?w.push(e.value):window.location.reload()}finally{r.value=!1}}})};return(d,s)=>{const O=i("el-alert"),C=i("el-input"),R=i("el-form-item"),G=i("el-button"),oe=i("el-image"),re=i("el-form");return S(),ye("div",xe,[t(re,{ref_key:"form",ref:p,model:a.value,class:"mx-auto md:max-w-xs"},{default:o(()=>[K("h3",Te,T(v(M)),1),L.value?(S(),D(O,{key:0,title:L.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):A("",!0),t(R,{prop:"username",rules:[{required:!0,message:()=>d.$t("v.required")}]},{default:o(()=>[t(C,{ref_key:"focus",ref:V,modelValue:a.value.username,"onUpdate:modelValue":s[0]||(s[0]=f=>a.value.username=f),name:"username",placeholder:d.$t("username"),"prefix-icon":v(we),autocomplete:"on"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"]),t(R,{prop:"password",rules:[{required:!0,message:()=>d.$t("v.required")}]},{default:o(()=>[t(C,{ref:"password",modelValue:a.value.password,"onUpdate:modelValue":s[1]||(s[1]=f=>a.value.password=f),type:"password",name:"password",placeholder:d.$t("password"),"prefix-icon":v(Ve),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"]),$.value?(S(),D(R,{key:1,prop:"shortMessageValue",rules:[{required:!0,message:()=>d.$t("v.required")}]},{default:o(()=>[t(C,{modelValue:a.value.shortMessageValue,"onUpdate:modelValue":s[3]||(s[3]=f=>a.value.shortMessageValue=f),name:"shortMessageValue",placeholder:d.$t("shortMessage"),"prefix-icon":v(_e)},{append:o(()=>[t(G,{disabled:b.value<60,onClick:s[2]||(s[2]=f=>I.value=!0)},{default:o(()=>[E(T(U.value),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"])):A("",!0),h.value?(S(),D(R,{key:2,prop:"captchaValue",rules:[{required:!0,message:()=>d.$t("v.required")},{asyncValidator:async(f,ue,z)=>{(k.value==null||!await v(le)(k.value,ue))&&z(d.$t("captchaIncorrect")),z()},trigger:"blur"}],class:"captcha"},{default:o(()=>[t(C,{modelValue:a.value.captchaValue,"onUpdate:modelValue":s[5]||(s[5]=f=>a.value.captchaValue=f),name:"captchaValue",placeholder:d.$t("captcha"),"prefix-icon":v(Z)},{append:o(()=>[t(oe,{src:_.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",onClick:s[4]||(s[4]=f=>m()),title:d.$t("clickToRetrieveCaptcha")},null,8,["src","title"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"])):A("",!0),t(G,{type:"primary","native-type":"submit",class:"w-full",loading:r.value,onClick:X(se,["prevent"])},{default:o(()=>[E(T(d.$t("login")),1)]),_:1},8,["loading","onClick"]),K("div",Be,[t(G,{type:"primary",onClick:s[6]||(s[6]=f=>P.value=!0),link:""},{default:o(()=>[E(T(d.$t("changePassword")),1)]),_:1})])]),_:1},8,["model"]),t(Ue,{modelValue:P.value,"onUpdate:modelValue":s[7]||(s[7]=f=>P.value=f)},null,8,["modelValue"]),t(Ie,{modelValue:I.value,"onUpdate:modelValue":s[8]||(s[8]=f=>I.value=f),onFinish:F},null,8,["modelValue"])])}}});var Re=qe(Ne,[["__scopeId","data-v-04d9c226"]]);export{Re as default};
