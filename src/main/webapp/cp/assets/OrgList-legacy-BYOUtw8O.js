System.register(["./index-legacy-CiIiERxr.js","./tree-legacy-Ctw3uqha.js","./user-legacy-DunabwBi.js","./QueryItem.vue_vue_type_script_setup_true_lang-legacy-B_0gkePB.js","./ListMove.vue_vue_type_script_setup_true_lang-legacy-xBzlqoIZ.js","./DialogForm.vue_vue_type_script_setup_true_lang-legacy-TqTurFLS.js","./data-legacy-D9lZwenC.js","./content-legacy-CaWWoJUd.js"],(function(e,l){"use strict";var a,t,u,d,n,o,s,i,r,c,v,m,p,b,g,h,y,f,k,_,V,w,C,$,x,P,U,I,D,j,q,S,F,E,A,B,O,z,N,Q,R,G,K,H,L,T,M,Z,J,W,X;return{setters:[e=>{a=e.d,t=e.p,u=e.r,d=e.v,n=e.b,o=e.e,s=e.f,i=e.w,r=e.i,c=e.h,v=e.j,m=e.u,p=e.Z,b=e.ac,g=e.o,h=e.k,y=e.l,f=e.t,k=e.E,_=e.c,V=e.I,w=e.g,C=e.aD,$=e.aE,x=e.aL,P=e.ak,U=e.ah,I=e.at},e=>{D=e.c,j=e.t,q=e.e,S=e.f,F=e.g},e=>{E=e.b,A=e.z,B=e.A,O=e.B,z=e.C,N=e.D,Q=e.E,R=e.F,G=e.G,K=e.H},e=>{H=e.a,L=e._,T=e.b,M=e.c},e=>{Z=e._},e=>{J=e._},e=>{W=e.b},e=>{X=e.g}],execute:function(){const l=a({name:"OrgForm",__name:"OrgForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parentId:{type:String,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){const a=e,{parentId:m,beanId:p,showGlobalData:b,modelValue:g}=t(a),h=l,y=u(),f=u({}),k=u([]),_=async e=>{k.value=D(j(await E({current:!b.value})),e?.id)},V=async e=>{await _(e),h("finished")};return d(g,(()=>{g.value&&_()})),(l,a)=>{const t=n("el-tree-select"),u=n("el-form-item"),d=n("el-input");return o(),s(J,{values:f.value,"onUpdate:values":a[5]||(a[5]=e=>f.value=e),name:l.$t("menu.user.org"),"query-bean":v(A),"create-bean":v(B),"update-bean":v(O),"delete-bean":v(z),"bean-id":v(p),"bean-ids":e.beanIds,focus:y.value,"init-values":e=>({parentId:v(m)}),"to-values":e=>({...e}),"disable-delete":e=>e.id<=1||e.id===k.value[0]?.id,perms:"org","model-value":e.modelValue,"onUpdate:modelValue":a[6]||(a[6]=e=>l.$emit("update:modelValue",e)),onFinished:V,onBeanChange:a[7]||(a[7]=()=>_())},{default:i((({isEdit:e})=>[e&&f.value.id===k.value[0]?.id?c("",!0):(o(),s(u,{key:0,prop:"parentId",label:l.$t("org.parent"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:i((()=>[r(t,{modelValue:f.value.parentId,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.parentId=e),data:k.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":k.value.map((e=>e.id)),"render-after-expand":!1,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])])),_:1},8,["label","rules"])),r(u,{prop:"name",label:l.$t("org.name"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:i((()=>[r(d,{ref_key:"focus",ref:y,modelValue:f.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.name=e),maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"]),r(u,{prop:"address",label:l.$t("org.address")},{default:i((()=>[r(d,{modelValue:f.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.address=e),maxlength:"255"},null,8,["modelValue"])])),_:1},8,["label"]),r(u,{prop:"phone",label:l.$t("org.phone")},{default:i((()=>[r(d,{modelValue:f.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value.phone=e),maxlength:"100"},null,8,["modelValue"])])),_:1},8,["label"]),r(u,{prop:"contacts",label:l.$t("org.contacts")},{default:i((()=>[r(d,{modelValue:f.value.contacts,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.contacts=e),maxlength:"100"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","disable-delete","model-value"])}}}),Y={class:"border-t"},ee={class:"border-t"},le={class:"border-t"},ae={class:"flex items-center justify-between"},te=a({name:"OrgPermissionForm",__name:"OrgPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){const a=e,c=l,{beanId:_,modelValue:V}=t(a),{t:w}=m(),C=u("articlePermission"),$=u(),x=u({}),P=u({}),U=u(!1),I=u(!1),D=u(!1),F=u(),B=u(!1),O=u(!1),z=u(),K=u(!1),H=u(!1),L=u(),T=W();q(T,p.grantPermissions??[]);const M=u([]),Z=u([]),J=b((()=>x.value.global&&!p.globalPermission||p.rank>x.value.rank));d(V,(async()=>{V.value&&((async()=>{null!=_.value&&(x.value=await A(_.value),P.value={...x.value})})(),(async()=>{if(null!=_.value){const e=await Q(_.value);F.value?.setCheckedKeys([]),e.forEach((e=>{F.value?.setChecked(e,!0,!1)}))}})(),(async()=>{if(null!=_.value){const e=await R(_.value);z.value?.setCheckedKeys([]),e.forEach((e=>{z.value?.setChecked(e,!0,!1)}))}})(),(async()=>{if(null!=_.value){const e=await G(_.value,a.showGlobalData);L.value?.setCheckedKeys([]),e.forEach((e=>{L.value?.setChecked(e,!0,!1)}))}})())})),g((()=>{(async()=>{M.value=j(await X())})(),(async()=>{Z.value=j(await E({current:!0}))})()}));const te=(e,l,a,t)=>{a.forEach((a=>{a.children&&(l.getNode(a[t??"key"]).expanded=e,te(e,l,a.children,t))}))},ue=(e,l,a,t)=>{l.setCheckedKeys(e?a.map((e=>e[t??"key"])):[])},de=()=>{null!=F.value&&(P.value.articlePermissions=[...F.value.getCheckedNodes(),...F.value.getHalfCheckedNodes()].map((e=>e.id)))},ne=()=>{null!=z.value&&(P.value.channelPermissions=[...z.value.getCheckedNodes(),...z.value.getHalfCheckedNodes()].map((e=>e.id)))},oe=()=>{null!=L.value&&(P.value.orgPermissions=L.value.getCheckedNodes().map((e=>e.id)))};return(l,a)=>{const t=n("el-checkbox"),u=n("el-tree"),d=n("el-tab-pane"),m=n("el-tabs"),p=n("el-form"),b=n("el-tag"),g=n("el-button"),_=n("el-drawer");return o(),s(_,{title:l.$t("permissionSettings"),"with-header":!1,"model-value":e.modelValue,size:576,"onUpdate:modelValue":a[18]||(a[18]=e=>l.$emit("update:modelValue",e))},{default:i((()=>[r(p,{ref_key:"form",ref:$,model:P.value,disabled:J.value,"label-width":"150px"},{default:i((()=>[r(m,{modelValue:C.value,"onUpdate:modelValue":a[15]||(a[15]=e=>C.value=e)},{default:i((()=>[r(d,{label:l.$t("org.articlePermission"),name:"articlePermission"},{default:i((()=>[h("div",Y,[r(t,{modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value=e),label:l.$t("expand/collapse"),onChange:a[1]||(a[1]=e=>te(e,F.value,M.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=e=>D.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[3]||(a[3]=e=>{ue(e,F.value,v(S)(M.value),"id"),de()})},null,8,["modelValue","label"])]),r(u,{ref_key:"articlePermissionTree",ref:F,data:M.value,"node-key":"id",props:{label:"name"},class:"border rounded","show-checkbox":"",onCheck:a[4]||(a[4]=()=>de())},null,8,["data"])])),_:1},8,["label"]),r(d,{label:l.$t("role.channelPermission"),name:"channelPermission"},{default:i((()=>[h("div",ee,[r(t,{modelValue:B.value,"onUpdate:modelValue":a[5]||(a[5]=e=>B.value=e),label:l.$t("expand/collapse"),onChange:a[6]||(a[6]=e=>te(e,z.value,M.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:O.value,"onUpdate:modelValue":a[7]||(a[7]=e=>O.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[8]||(a[8]=e=>{ue(e,z.value,v(S)(M.value),"id"),ne()})},null,8,["modelValue","label"])]),r(u,{ref_key:"channelPermissionTree",ref:z,data:M.value,"node-key":"id",props:{label:"name"},class:"border rounded","check-strictly":"","show-checkbox":"",onCheck:a[9]||(a[9]=()=>ne())},null,8,["data"])])),_:1},8,["label"]),r(d,{label:l.$t("org.orgPermission"),name:"orgPermission"},{default:i((()=>[h("div",le,[r(t,{modelValue:K.value,"onUpdate:modelValue":a[10]||(a[10]=e=>K.value=e),label:l.$t("expand/collapse"),onChange:a[11]||(a[11]=e=>te(e,L.value,Z.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:H.value,"onUpdate:modelValue":a[12]||(a[12]=e=>H.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[13]||(a[13]=e=>{ue(e,L.value,v(S)(Z.value),"id"),oe()})},null,8,["modelValue","label"])]),r(u,{ref_key:"orgPermissionTree",ref:L,data:Z.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expanded-keys":Z.value.map((e=>e.id)),"show-checkbox":"","check-strictly":"",onCheck:a[14]||(a[14]=()=>oe())},null,8,["data","default-expanded-keys"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["model","disabled"])])),footer:i((()=>[h("div",ae,[h("div",null,[r(b,null,{default:i((()=>[y(f(P.value?.name),1)])),_:1})]),h("div",null,[r(g,{onClick:a[16]||(a[16]=()=>l.$emit("update:modelValue",!1))},{default:i((()=>[y(f(l.$t("cancel")),1)])),_:1}),r(g,{type:"primary",loading:U.value,disabled:J.value,onClick:a[17]||(a[17]=()=>{$.value.validate((async e=>{if(e){U.value=!0;try{de(),ne(),oe(),await N(P.value),c("finished"),c("update:modelValue",!1),k.success(w("success"))}finally{U.value=!1}}}))})},{default:i((()=>[y(f(l.$t("save")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["title","model-value"])}}}),ue={class:"mb-3"},de={class:"mt-3 app-block"};e("default",a({name:"OrgList",__name:"OrgList",setup(e){const{t:a}=m(),t=u({}),d=u(),D=u(),q=u([]),A=u([]),B=u(!1),O=u(!1),N=u(!1),Q=u(),R=b((()=>q.value.map((e=>e.id)))),G=u(!1),J=u("1"),W=u(!1),X=u(["1"]),Y=async()=>{B.value=!0;try{q.value=await E({...C(t.value),current:!W.value,Q_OrderBy:d.value}),G.value=Object.values(t.value).filter((e=>void 0!==e&&""!==e)).length>0||void 0!==d.value,G.value||(q.value=j(q.value)),J.value=q.value[0]?.id}finally{B.value=!1}};g(Y);const ee=({column:e,prop:l,order:a})=>{d.value=l&&a?(e.sortBy??l)+("descending"===a?"_desc":""):void 0,Y()},le=()=>Y(),ae=()=>{D.value.clearSort(),$(t.value),d.value=void 0,Y()},ne=e=>{Q.value=void 0,null!=e&&(J.value=e),O.value=!0},oe=e=>{Q.value=e,O.value=!0},se=async e=>{await z(e),Y(),k.success(a("success"))},ie=e=>e.id>1;return(e,a)=>{const u=n("el-button"),d=n("el-popconfirm"),m=n("el-checkbox"),b=n("el-table-column"),g=n("el-table"),k=_("loading");return o(),V("div",null,[h("div",ue,[r(v(L),{params:t.value,onSearch:le,onReset:ae},{default:i((()=>[r(v(H),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),r(v(H),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),r(v(H),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),r(v(H),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])])),_:1},8,["params"])]),h("div",null,[r(u,{type:"primary",icon:v(P),onClick:a[0]||(a[0]=()=>ne())},{default:i((()=>[y(f(e.$t("add")),1)])),_:1},8,["icon"]),r(d,{title:e.$t("confirmDelete"),onConfirm:a[1]||(a[1]=()=>se(A.value.map((e=>e.id))))},{reference:i((()=>[r(u,{disabled:A.value.length<=0,icon:v(U)},{default:i((()=>[y(f(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),r(Z,{class:"ml-2",disabled:A.value.length<=0||G.value||v(I)("org:update"),onMove:a[2]||(a[2]=e=>(async(e,l)=>{const a=x(e,S(q.value),l);await K(a),await Y(),e.forEach((e=>{D.value.toggleRowSelection(F(q.value,(l=>l.id===e.id)))}))})(A.value,e))},null,8,["disabled"]),v(p).globalPermission?(o(),s(m,{key:0,modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value=e),class:"ml-2 align-middle",label:e.$t("globalData"),border:!0,onChange:a[4]||(a[4]=()=>Y())},null,8,["modelValue","label"])):c("",!0),r(v(T),{name:"org",class:"ml-2"})]),h("div",de,[w((o(),s(g,{ref_key:"table",ref:D,"row-key":"id",data:q.value,"expand-row-keys":X.value,onSelectionChange:a[5]||(a[5]=e=>A.value=e),onRowDblclick:a[6]||(a[6]=e=>oe(e.id)),onSortChange:ee},{default:i((()=>[r(v(M),{name:"org"},{default:i((()=>[r(b,{type:"selection",selectable:ie,width:"45"}),r(b,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120"},{default:i((({row:e})=>[y(f(G.value?e.names?.join(" / "):e.name),1)])),_:1},8,["label"]),r(b,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100"},null,8,["label"]),r(b,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100"},null,8,["label"]),r(b,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom"},null,8,["label"]),r(b,{property:"id",label:"ID",width:"170",sortable:"custom"}),r(b,{label:e.$t("table.action"),width:"230"},{default:i((({row:l})=>[r(u,{type:"primary",disabled:v(I)("org:create"),size:"small",link:"",onClick:()=>ne(l.id)},{default:i((()=>[y(f(e.$t("addChild")),1)])),_:2},1032,["disabled","onClick"]),r(u,{type:"primary",disabled:v(I)("org:update"),size:"small",link:"",onClick:()=>oe(l.id)},{default:i((()=>[y(f(e.$t("edit")),1)])),_:2},1032,["disabled","onClick"]),v(p).epRank>=3||v(p).epDisplay?(o(),s(u,{key:0,title:v(p).epRank<3?e.$t("error.enterprise.short"):void 0,disabled:v(I)("org:updatePermission")||v(p).epRank<3,type:"primary",size:"small",link:"",onClick:()=>{return e=l.id,Q.value=e,void(N.value=!0);var e}},{default:i((()=>[y(f(e.$t("permissionSettings")),1)])),_:2},1032,["title","disabled","onClick"])):c("",!0),r(d,{title:e.$t("confirmDelete"),onConfirm:()=>se([l.id])},{reference:i((()=>[r(u,{type:"primary",disabled:!ie(l)||v(I)("org:delete"),size:"small",link:""},{default:i((()=>[y(f(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data","expand-row-keys"])),[[k,B.value]])]),r(l,{modelValue:O.value,"onUpdate:modelValue":a[7]||(a[7]=e=>O.value=e),"bean-id":Q.value,"bean-ids":R.value,"parent-id":J.value,"show-global-data":W.value,onFinished:Y},null,8,["modelValue","bean-id","bean-ids","parent-id","show-global-data"]),r(te,{modelValue:N.value,"onUpdate:modelValue":a[8]||(a[8]=e=>N.value=e),"bean-id":Q.value,"show-global-data":W.value,onFinished:Y},null,8,["modelValue","bean-id","show-global-data"])])}}}))}}}));
