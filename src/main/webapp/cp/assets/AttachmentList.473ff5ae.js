var O=Object.defineProperty,U=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var E=(u,o,n)=>o in u?O(u,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[o]=n,C=(u,o)=>{for(var n in o||(o={}))J.call(o,n)&&E(u,n,o[n]);if(A)for(var n of A(o))K.call(o,n)&&E(u,n,o[n]);return u},z=(u,o)=>U(u,G(o));import{g as W,u as X,I as i,M as Z,j as p,N as x,o as y,q as D,y as k,l as a,m as d,w as s,O as ee,k as te,Q as ae,ap as le,P as v,A as f,f as oe,F as ne,C as se}from"./vendor.7e46e91a.js";import{r as re,v as ie,o as ue,w as de,m as L}from"./index.9cf006c5.js";import{b as me,d as ce}from"./system.4ae90682.js";import{a as pe,b as fe,_ as be,c as ve}from"./QueryItem.713a2356.js";const he={class:"mb-3"},ge={class:"app-block mt-3"},ye={name:"AttachmentList"},ze=W(z(C({},ye),{setup(u){const{t:o}=X(),n=i({}),h=i(),_=i(1),w=i(10),P=i(0),B=i(),I=i([]),$=i([]),S=i(!1),N=i(!1),V=i(),m=async()=>{S.value=!0;try{const{content:t,totalElements:l}=await me(z(C({},ue(n.value)),{Q_OrderBy:h.value,page:_.value,pageSize:w.value}));I.value=t,P.value=l}finally{S.value=!1}};Z(m);const Y=({column:t,prop:l,order:g})=>{var b;l?h.value=((b=t.sortBy)!=null?b:l)+(g==="descending"?"_desc":""):h.value=void 0,m()},j=()=>m(),Q=()=>{B.value.clearSort(),de(n.value),h.value=void 0,m()},R=t=>{V.value=t,N.value=!0},M=async t=>{await ce(t),m(),ae.success(o("success"))};return(t,l)=>{const g=p("el-button"),b=p("el-popconfirm"),r=p("el-table-column"),T=p("el-tag"),q=p("el-table"),F=p("el-pagination"),H=x("loading");return y(),D("div",null,[k("div",he,[a(d(pe),{params:n.value,onSearch:j,onReset:Q},{default:s(()=>[a(d(be),{label:t.$t("attachment.name"),name:"Q_Contains_name"},null,8,["label"])]),_:1},8,["params"])]),k("div",null,[a(b,{title:t.$t("confirmDelete"),onConfirm:l[0]||(l[0]=e=>M($.value.map(c=>c.id)))},{reference:s(()=>[a(g,{disabled:$.value.length<=0||d(L)("attachment:delete"),icon:d(le)},{default:s(()=>[v(f(t.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(d(fe),{name:"attachment",class:"ml-2"})]),k("div",ge,[ee((y(),te(q,{ref_key:"table",ref:B,data:I.value,onSelectionChange:l[1]||(l[1]=e=>$.value=e),onRowDblclick:l[2]||(l[2]=e=>R(e.id)),onSortChange:Y},{default:s(()=>[a(d(ve),{name:"attachment"},{default:s(()=>[a(r,{type:"selection",selectable:e=>!e.used,width:"45"},null,8,["selectable"]),a(r,{property:"id",label:"ID",width:"64",sortable:"custom"}),a(r,{property:"name",label:t.$t("attachment.name"),sortable:"custom","min-width":"130","show-overflow-tooltip":""},null,8,["label"]),a(r,{property:"path",label:t.$t("attachment.path"),sortable:"custom","min-width":"200",display:"none","show-overflow-tooltip":""},null,8,["label"]),a(r,{property:"url",label:t.$t("attachment.url"),sortable:"custom","min-width":"350",display:"none","show-overflow-tooltip":""},null,8,["label"]),a(r,{property:"length",label:t.$t("attachment.length"),sortable:"custom",align:"right","show-overflow-tooltip":""},{default:s(({row:e})=>[v(f(e.size),1)]),_:1},8,["label"]),a(r,{property:"created",label:t.$t("attachment.created"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:s(({row:e})=>[v(f(d(oe)(e.created).format("YYYY-MM-DD HH:mm")),1)]),_:1},8,["label"]),a(r,{property:"user.username",label:t.$t("attachment.user"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),a(r,{label:t.$t("attachment.refer"),"show-overflow-tooltip":""},{default:s(({row:e})=>[(y(!0),D(ne,null,se(e.referList,c=>(y(),D("div",{key:`${c.referType}-${c.referId}`},f(`${c.referType}-${c.referId}`),1))),128))]),_:1},8,["label"]),a(r,{property:"used",label:t.$t("attachment.used"),sortable:"custom","show-overflow-tooltip":""},{default:s(({row:e})=>[a(T,{type:e.used?"success":"info",size:"small"},{default:s(()=>[v(f(t.$t(e.used?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(r,{label:t.$t("table.action")},{default:s(({row:e})=>[a(b,{title:t.$t("confirmDelete"),onConfirm:c=>M([e.id])},{reference:s(()=>[a(g,{type:"primary",disabled:e.used||d(L)("attachment:delete"),size:"small",link:""},{default:s(()=>[v(f(t.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[H,S.value]]),a(F,{currentPage:_.value,"onUpdate:currentPage":l[3]||(l[3]=e=>_.value=e),pageSize:w.value,"onUpdate:pageSize":l[4]||(l[4]=e=>w.value=e),total:P.value,"page-sizes":d(re),layout:d(ie),onSizeChange:l[5]||(l[5]=e=>m()),onCurrentChange:l[6]||(l[6]=e=>m()),small:"",background:"",class:"px-3 py-2 justify-end"},null,8,["currentPage","pageSize","total","page-sizes","layout"])])])}}}));export{ze as default};
