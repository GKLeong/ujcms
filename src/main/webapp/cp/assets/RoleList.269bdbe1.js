var Ce=Object.defineProperty,he=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var de=(V,b,r)=>b in V?Ce(V,b,{enumerable:!0,configurable:!0,writable:!0,value:r}):V[b]=r,O=(V,b)=>{for(var r in b||(b={}))qe.call(b,r)&&de(V,r,b[r]);if(ue)for(var r of ue(b))Ue.call(b,r)&&de(V,r,b[r]);return V},K=(V,b)=>he(V,we(b));import{g as te,I as d,j as m,o as w,k as E,w as a,l as e,m as i,q as J,C as se,F as le,P as _,A as P,t as Ae,u as pe,i as ve,R as Ie,M as be,y as L,x as Be,Q as fe,N as Ne,ao as Re,O as Se,an as De}from"./vendor.8f1addd2.js";import{c as R,p as oe,t as Te,r as ze,k as Ee}from"./index.36604f4c.js";import{r as Fe,k as ce,l as Le,n as je,o as ye,p as Me,s as Oe,g as Qe,t as He}from"./user.53b19a61.js";import{a as Ke,b as Ge,_ as me,c as Je}from"./QueryItem.f45658c4.js";import{_ as We}from"./ListMove.491706f0.js";import{_ as Xe}from"./DialogForm.ed473c62.js";import{_ as G}from"./LabelTip.9bcdedcd.js";import{b as Ye}from"./data.e82e6b49.js";import{b as Ze,t as xe}from"./tree.4a0f1dfa.js";import{f as el}from"./content.1389a352.js";const ll={name:"RoleForm"},al=te(K(O({},ll),{props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(V){const b=d(),r=d({});return(u,v)=>{const S=m("el-input"),C=m("el-form-item"),F=m("el-input-number"),q=m("el-option"),f=m("el-select"),A=m("el-radio"),Q=m("el-radio-group");return w(),E(Xe,{name:u.$t("menu.user.role"),queryBean:i(ce),createBean:i(Le),updateBean:i(je),deleteBean:i(ye),beanId:V.beanId,beanIds:V.beanIds,focus:b.value,initValues:()=>({type:4,rank:i(R).rank+1,scope:0}),toValues:y=>O({},y),disableDelete:y=>y.id<=1,disableEdit:y=>y.global&&!i(R).globalPermission||i(R).rank>y.rank,perms:"role",values:r.value,"onUpdate:values":v[5]||(v[5]=y=>r.value=y),"model-value":V.modelValue,"onUpdate:modelValue":v[6]||(v[6]=y=>u.$emit("update:modelValue",y)),onFinished:v[7]||(v[7]=y=>u.$emit("finished"))},{default:a(({bean:y,disabled:k})=>[e(C,{prop:"name",label:u.$t("role.name"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:a(()=>[e(S,{modelValue:r.value.name,"onUpdate:modelValue":v[0]||(v[0]=p=>r.value.name=p),ref_key:"focus",ref:b,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{prop:"description",label:u.$t("role.description")},{default:a(()=>[e(S,{modelValue:r.value.description,"onUpdate:modelValue":v[1]||(v[1]=p=>r.value.description=p),maxlength:"300"},null,8,["modelValue"])]),_:1},8,["label"]),e(C,{prop:"rank",rules:[{required:!0,message:()=>u.$t("v.required")}]},{label:a(()=>[e(G,{message:"role.rank",help:""})]),default:a(()=>[e(F,{modelValue:r.value.rank,"onUpdate:modelValue":v[2]||(v[2]=p=>r.value.rank=p),modelModifiers:{number:!0},min:k?0:i(R).rank,max:32767},null,8,["modelValue","min"])]),_:2},1032,["rules"]),e(C,{prop:"type",rules:[{required:!0,message:()=>u.$t("v.required")}]},{label:a(()=>[e(G,{message:"role.type",help:""})]),default:a(()=>[e(f,{modelValue:r.value.type,"onUpdate:modelValue":v[3]||(v[3]=p=>r.value.type=p)},{default:a(()=>[(w(),J(le,null,se([1,2,3,4],p=>e(q,{key:p,label:u.$t(`role.type.${p}`),value:p},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(C,{prop:"scope",label:u.$t("block.scope"),rules:[{required:!0,message:()=>u.$t("v.required")},{asyncValidator:async(p,H,I)=>{H!==y.scope&&await i(Fe)(r.value.scope)&&I(u.$t("role.error.scopeNotAllowd")),I()}}]},{default:a(()=>[e(Q,{modelValue:r.value.scope,"onUpdate:modelValue":v[4]||(v[4]=p=>r.value.scope=p)},{default:a(()=>[(w(),J(le,null,se([0,2],p=>e(A,{key:p,label:p,disabled:!i(R).globalPermission},{default:a(()=>[_(P(u.$t(`role.scope.${p}`)),1)]),_:2},1032,["label","disabled"])),64))]),_:1},8,["modelValue"])]),_:2},1032,["label","rules"])]),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","disableEdit","values","model-value"])}}})),ol={class:"border-t"},sl={class:"flex justify-between items-center"},tl={name:"RolePermissionForm"},nl=te(K(O({},tl),{props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(V,{emit:b}){var ne;const r=V,{beanId:u,modelValue:v}=Ae(r),{t:S}=pe(),C=d("permission"),F=d(),q=d({}),f=d({}),A=d(!1),Q=d(!0),y=d(!1),k=d(),p=d(!0),H=d(!1),I=d(),W=d(!0),X=d(!1),D=d(),T=Ye();Ze(T,(ne=R.grantPermissions)!=null?ne:[]);const j=d([]),Y=ve(()=>q.value.global&&!R.globalPermission||R.rank>q.value.rank),s=async()=>{var n,l,c,g,U,ee;(u==null?void 0:u.value)!=null&&(q.value=await ce(u.value),f.value=O({},q.value),(c=k.value)==null||c.setCheckedKeys((l=(n=q.value.permission)==null?void 0:n.split(","))!=null?l:[]),(ee=I.value)==null||ee.setCheckedKeys((U=(g=q.value.grantPermission)==null?void 0:g.split(","))!=null?U:[]))},$=async()=>{(u==null?void 0:u.value)!=null&&(await Oe(u.value)).forEach(l=>{var c;(c=D.value)==null||c.setChecked(l,!0,!1)})},B=async()=>{j.value=xe(await el())};Ie(v,()=>{v.value&&(s(),$())}),be(()=>{B()});const z=()=>{F.value.validate(async n=>{if(!!n){A.value=!0;try{await Me(f.value),b("finished"),b("update:modelValue",!1),fe.success(S("success"))}finally{A.value=!1}}})},h=(n,l,c,g)=>{c.forEach(U=>{U.children&&(l.getNode(U[g!=null?g:"key"]).expanded=n,h(n,l,U.children,g))})},N=(n,l,c,g)=>{l.setCheckedKeys(n?c.map(U=>U[g!=null?g:"key"]):[])},Z=()=>{f.value.permission=M(k.value.getCheckedNodes(),k.value.getHalfCheckedNodes())},x=()=>{f.value.grantPermission=M(I.value.getCheckedNodes(),I.value.getHalfCheckedNodes())},t=()=>{f.value.articlePermissions=[...D.value.getCheckedNodes(),...D.value.getHalfCheckedNodes()].map(n=>n.id)},M=(n,l)=>[...n,...l].filter(c=>c.perms).map(c=>{var g;return(g=c.perms)==null?void 0:g.join(",")}).join(",");return(n,l)=>{const c=m("el-checkbox"),g=m("el-tree"),U=m("el-tab-pane"),ee=m("el-alert"),re=m("el-switch"),ae=m("el-form-item"),$e=m("el-option"),ge=m("el-select"),Ve=m("el-tabs"),ke=m("el-form"),_e=m("el-tag"),ie=m("el-button"),Pe=m("el-drawer");return w(),E(Pe,{title:n.$t("permissionSettings"),"with-header":!1,"model-value":V.modelValue,"onUpdate:modelValue":l[21]||(l[21]=o=>n.$emit("update:modelValue",o)),size:576},{default:a(()=>[e(ke,{ref_key:"form",ref:F,model:f.value,disabled:i(Y),"label-width":"150px"},{default:a(()=>[e(Ve,{modelValue:C.value,"onUpdate:modelValue":l[18]||(l[18]=o=>C.value=o)},{default:a(()=>[e(U,{label:n.$t("role.permission"),name:"permission"},{default:a(()=>[L("div",null,[e(c,{modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=o=>Q.value=o),onChange:l[1]||(l[1]=o=>h(o,k.value,i(T))),disabled:!1,label:n.$t("expand/collapse")},null,8,["modelValue","label"]),e(c,{modelValue:y.value,"onUpdate:modelValue":l[2]||(l[2]=o=>y.value=o),onChange:l[3]||(l[3]=o=>{N(o,k.value,i(T)),Z()}),label:n.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),e(g,{ref_key:"permissionTree",ref:k,data:i(T),"node-key":"key",onCheck:l[4]||(l[4]=o=>Z()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"]),e(U,{label:n.$t("role.grantPermission"),name:"grantPermission"},{default:a(()=>[e(ee,{title:n.$t("role.grantPermission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),L("div",null,[e(c,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=o=>p.value=o),onChange:l[6]||(l[6]=o=>h(o,I.value,i(T))),label:n.$t("expand/collapse")},null,8,["modelValue","label"]),e(c,{modelValue:H.value,"onUpdate:modelValue":l[7]||(l[7]=o=>H.value=o),onChange:l[8]||(l[8]=o=>{N(o,I.value,i(T)),x()}),label:n.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),e(g,{ref_key:"grantPermissionTree",ref:I,data:i(T),"node-key":"key",onCheck:l[9]||(l[9]=o=>x()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"]),e(U,{label:n.$t("role.dataPermission"),name:"dataPermission"},{default:a(()=>[e(ae,{prop:"globalPermission",rules:{required:!0,message:()=>n.$t("v.required")}},{label:a(()=>[e(G,{message:"role.globalPermission",help:""})]),default:a(()=>[e(re,{modelValue:f.value.globalPermission,"onUpdate:modelValue":l[10]||(l[10]=o=>f.value.globalPermission=o),disabled:!i(R).globalPermission},null,8,["modelValue","disabled"])]),_:1},8,["rules"]),e(ae,{prop:"dataScope",rules:[{required:!0,message:()=>n.$t("v.required")}]},{label:a(()=>[e(G,{message:"role.dataScope",help:""})]),default:a(()=>[e(ge,{modelValue:f.value.dataScope,"onUpdate:modelValue":l[11]||(l[11]=o=>f.value.dataScope=o)},{default:a(()=>[(w(),J(le,null,se([1,2,3],o=>e($e,{key:o,label:n.$t(`role.dataScope.${o}`),value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["label"]),e(U,{label:n.$t("role.articlePermission"),name:"articlePermission"},{default:a(()=>[e(ae,{prop:"allArticlePermission",rules:{required:!0,message:()=>n.$t("v.required")}},{label:a(()=>[e(G,{message:"role.allArticlePermission",help:""})]),default:a(()=>[e(re,{modelValue:f.value.allArticlePermission,"onUpdate:modelValue":l[12]||(l[12]=o=>f.value.allArticlePermission=o)},null,8,["modelValue"])]),_:1},8,["rules"]),f.value.allArticlePermission?Be("",!0):(w(),J(le,{key:0},[L("div",ol,[e(c,{modelValue:W.value,"onUpdate:modelValue":l[13]||(l[13]=o=>W.value=o),onChange:l[14]||(l[14]=o=>h(o,D.value,j.value,"id")),label:n.$t("expand/collapse")},null,8,["modelValue","label"]),e(c,{modelValue:X.value,"onUpdate:modelValue":l[15]||(l[15]=o=>X.value=o),onChange:l[16]||(l[16]=o=>{N(o,D.value,j.value,"id"),t()}),label:n.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),e(g,{ref_key:"articlePermissionTree",ref:D,data:j.value,"node-key":"id",onCheck:l[17]||(l[17]=o=>t()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["model","disabled"])]),footer:a(()=>[L("div",sl,[L("div",null,[e(_e,null,{default:a(()=>{var o;return[_(P((o=f.value)==null?void 0:o.name),1)]}),_:1})]),L("div",null,[e(ie,{onClick:l[19]||(l[19]=o=>n.$emit("update:modelValue",!1))},{default:a(()=>[_(P(n.$t("cancel")),1)]),_:1}),e(ie,{type:"primary",onClick:l[20]||(l[20]=o=>z()),loading:A.value,disabled:i(Y)},{default:a(()=>[_(P(n.$t("submit")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}})),rl={class:"mb-3"},il={name:"RoleList"},Vl=te(K(O({},il),{setup(V){const{t:b}=pe(),r=d({}),u=d(),v=d(),S=d([]),C=d([]),F=d(!1),q=d(!1),f=d(!1),A=d(),Q=ve(()=>S.value.map(s=>s.id)),y=d(!1),k=async()=>{F.value=!0;try{S.value=await Qe(K(O({},Te(r.value)),{Q_OrderBy:u.value})),y.value=Object.values(r.value).filter(s=>s!==void 0&&s!=="").length>0||u.value!==void 0}finally{F.value=!1}};be(k);const p=s=>s.global&&!R.globalPermission||R.rank>s.rank,H=({column:s,prop:$,order:B})=>{var z;$?u.value=((z=s.sortBy)!=null?z:$)+(B==="descending"?"_desc":""):u.value=void 0,k()},I=()=>k(),W=()=>{v.value.clearSort(),ze(r.value),u.value=void 0,k()},X=()=>{A.value=void 0,q.value=!0},D=s=>{A.value=s,q.value=!0},T=s=>{A.value=s,f.value=!0},j=async s=>{await ye(s),k(),fe.success(b("success"))},Y=async(s,$)=>{const B=Ee(s,S.value,$);await He(B.map(z=>z.id))};return(s,$)=>{const B=m("el-button"),z=m("el-popconfirm"),h=m("el-table-column"),N=m("el-tag"),Z=m("el-table"),x=Ne("loading");return w(),J("div",null,[L("div",rl,[e(i(Ke),{params:r.value,onSearch:I,onReset:W},{default:a(()=>[e(i(me),{label:s.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),e(i(me),{label:s.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),L("div",null,[e(B,{type:"primary",icon:i(Re),onClick:X},{default:a(()=>[_(P(s.$t("add")),1)]),_:1},8,["icon"]),e(z,{title:s.$t("confirmDelete"),onConfirm:$[0]||($[0]=t=>j(C.value.map(M=>M.id)))},{reference:a(()=>[e(B,{disabled:C.value.length<=0,icon:i(De)},{default:a(()=>[_(P(s.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(We,{class:"ml-2",disabled:C.value.length<=0||y.value||i(oe)("role:update"),onMove:$[1]||($[1]=t=>Y(C.value,t))},null,8,["disabled"]),e(i(Ge),{name:"role",class:"ml-2"})]),Se((w(),E(Z,{ref_key:"table",ref:v,data:S.value,onSelectionChange:$[2]||($[2]=t=>C.value=t),onRowDblclick:$[3]||($[3]=t=>D(t.id)),onSortChange:H,class:"mt-3 shadow bg-white"},{default:a(()=>[e(i(Je),{name:"role"},{default:a(()=>[e(h,{type:"selection",selectable:t=>!p(t),width:"50"},null,8,["selectable"]),e(h,{property:"id",label:"ID",width:"64",sortable:"custom"}),e(h,{property:"name",label:s.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(h,{property:"description",label:s.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(h,{property:"rank",label:s.$t("role.rank"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(h,{property:"globalPermission",label:s.$t("role.globalPermission"),sortable:"custom"},{default:a(({row:t})=>[e(N,{type:t.globalPermission?"success":"info",size:"small"},{default:a(()=>[_(P(s.$t(t.globalPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(h,{property:"type",label:s.$t("role.type"),sortable:"custom"},{default:a(({row:t})=>[t.type===1?(w(),E(N,{key:0,size:"small"},{default:a(()=>[_(P(s.$t(`role.type.${t.type}`)),1)]),_:2},1024)):t.type===2?(w(),E(N,{key:1,type:"warning",size:"small"},{default:a(()=>[_(P(s.$t(`role.type.${t.type}`)),1)]),_:2},1024)):t.type===3?(w(),E(N,{key:2,type:"success",size:"small"},{default:a(()=>[_(P(s.$t(`role.type.${t.type}`)),1)]),_:2},1024)):(w(),E(N,{key:3,type:"info",size:"small"},{default:a(()=>[_(P(s.$t(`role.type.${t.type}`)),1)]),_:2},1024))]),_:1},8,["label"]),e(h,{property:"scope",label:s.$t("role.scope"),sortable:"custom"},{default:a(({row:t})=>[t.scope===2?(w(),E(N,{key:0,type:"success",size:"small"},{default:a(()=>[_(P(s.$t(`role.scope.${t.scope}`)),1)]),_:2},1024)):(w(),E(N,{key:1,type:"info",size:"small"},{default:a(()=>[_(P(s.$t(`role.scope.${t.scope}`)),1)]),_:2},1024))]),_:1},8,["label"]),e(h,{label:s.$t("table.action")},{default:a(({row:t})=>[e(B,{type:"primary",onClick:M=>D(t.id),disabled:i(oe)("role:update"),size:"small",link:""},{default:a(()=>[_(P(s.$t("edit")),1)]),_:2},1032,["onClick","disabled"]),e(B,{type:"primary",onClick:M=>T(t.id),disabled:i(oe)("role:updatePermission"),size:"small",link:""},{default:a(()=>[_(P(s.$t("permissionSettings")),1)]),_:2},1032,["onClick","disabled"]),e(z,{title:s.$t("confirmDelete"),onConfirm:M=>j([t.id])},{reference:a(()=>[e(B,{type:"primary",size:"small",disabled:p(t),link:""},{default:a(()=>[_(P(s.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[x,F.value]]),e(al,{modelValue:q.value,"onUpdate:modelValue":$[4]||($[4]=t=>q.value=t),beanId:A.value,beanIds:i(Q),onFinished:k},null,8,["modelValue","beanId","beanIds"]),e(nl,{modelValue:f.value,"onUpdate:modelValue":$[5]||($[5]=t=>f.value=t),beanId:A.value,onFinished:k},null,8,["modelValue","beanId"])])}}}));export{Vl as default};
