import{d as te,u as oe,r as i,X as B,v as ne,o as se,a as d,b as ie,c as _,e as g,w as o,h as l,I as de,a8 as ce,a7 as me,j as D,i as n,as as p,a4 as re,k as V,t as C,a1 as ue,f as pe,g as q,aD as be,aI as ve,E as z,cw as _e,_ as fe}from"./index-07310ff6.js";import{a as ke}from"./config-e88c2eae.js";import{E as Ie,v as ge,m as ye,F as he}from"./content-57570363.js";import{_ as we,a as $e,b as Be,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-a4f060b2.js";import{_ as Ce}from"./ListMove.vue_vue_type_script_setup_true_lang-94f3400b.js";import{a as Le}from"./BlockItemForm.vue_vue_type_script_setup_true_lang-3d3f4536.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-84cdaac8.js";import"./BaseUpload.vue_vue_type_style_index_0_scoped_5165bd65_lang-452c0238.js";import"./BaseUpload-96a78565.js";const Se={class:"mb-3"},De={class:"app-block mt-3"},Ne={name:"BlockItemList"},Ue=te({...Ne,setup(Ee){const{t:N}=oe(),y=i({}),f=i(),U=i(),b=i([]),k=i([]),L=i(!1),h=i(!1),S=i(),Q=B(()=>b.value.map(e=>e.id)),E=i(!1),w=i([]),r=i(),A=B(()=>w.value.find(e=>e.id===Number(r.value))),T=B(()=>b.value.map(e=>e.image)),X=B(()=>b.value.map(e=>e.mobileImage)),u=async()=>{L.value=!0;try{b.value=await Ie({...be(y.value),blockId:Number(r.value),Q_OrderBy:f.value}),E.value=Object.values(y.value).filter(e=>e!==void 0&&e!=="").length>0||f.value!==void 0}finally{L.value=!1}},G=async()=>{w.value=await ke(),r.value=String(w.value[0].id)};ne(r,()=>u()),se(async()=>{await G()});const H=({column:e,prop:t,order:I})=>{var v;t?f.value=((v=e.sortBy)!=null?v:t)+(I==="descending"?"_desc":""):f.value=void 0,u()},J=()=>u(),K=()=>{U.value.clearSort(),ve(y.value),f.value=void 0,u()},W=()=>{S.value=void 0,h.value=!0},F=e=>{S.value=e,h.value=!0},M=async e=>{await ge(e),u(),z.success(N("success"))},O=async e=>{await ye(e),u(),z.success(N("success"))},Y=async(e,t)=>{const I=_e(e,b.value,t);await he(I.map(v=>v.id))};return(e,t)=>{const I=d("el-tab-pane"),v=d("el-tabs"),Z=d("el-aside"),$=d("el-button"),P=d("el-popconfirm"),c=d("el-table-column"),R=d("el-image"),j=d("el-switch"),x=d("el-table"),ee=d("el-main"),ae=d("el-container"),le=ie("loading");return _(),g(ae,null,{default:o(()=>[l(Z,{width:"180px",class:"pr-3"},{default:o(()=>[l(v,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=m=>r.value=m),"tab-position":"left",stretch:"",class:"bg-white"},{default:o(()=>[(_(!0),de(me,null,ce(w.value,m=>(_(),g(I,{key:m.id,name:String(m.id),label:m.name},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ee,{class:"p-0"},{default:o(()=>{var m;return[D("div",Se,[l(n(we),{params:y.value,onSearch:J,onReset:K},{default:o(()=>[l(n($e),{label:e.$t("blockItem.title"),name:"Q_Contains_title"},null,8,["label"])]),_:1},8,["params"])]),D("div",null,[l($,{type:"primary",disabled:!((m=n(A))!=null&&m.enabled)||n(p)("blockItem:create"),icon:n(re),onClick:t[1]||(t[1]=a=>W())},{default:o(()=>[V(C(e.$t("add")),1)]),_:1},8,["disabled","icon"]),l(P,{title:e.$t("confirmDelete"),onConfirm:t[2]||(t[2]=a=>O(k.value.map(s=>s.id)))},{reference:o(()=>[l($,{disabled:k.value.length<=0||n(p)("blockItem:delete"),icon:n(ue)},{default:o(()=>[V(C(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(Ce,{disabled:k.value.length<=0||E.value||n(p)("org:update"),onMove:t[3]||(t[3]=a=>Y(k.value,a)),class:"ml-2"},null,8,["disabled"]),l(n(Be),{name:"blockItem",class:"ml-2"})]),D("div",De,[pe((_(),g(x,{ref_key:"table",ref:U,data:b.value,onSelectionChange:t[4]||(t[4]=a=>k.value=a),onRowDblclick:t[5]||(t[5]=a=>F(a.id)),onSortChange:H},{default:o(()=>[l(n(Ve),{name:"blockItem"},{default:o(()=>[l(c,{type:"selection",width:"45"}),l(c,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(c,{property:"title",label:e.$t("blockItem.title"),sortable:"custom","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),l(c,{property:"image",label:e.$t("blockItem.image")},{default:o(({row:a,$index:s})=>[a.image?(_(),g(R,{key:0,src:a.image,fit:"contain","preview-src-list":n(T),"initial-index":s,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):q("",!0)]),_:1},8,["label"]),l(c,{property:"mobileImage",label:e.$t("blockItem.mobileImage"),display:"none"},{default:o(({row:a,$index:s})=>[a.mobileImage?(_(),g(R,{key:0,src:a.mobileImage,fit:"contain","preview-src-list":n(X),"initial-index":s,"preview-teleported":"",class:"w-32 h-32"},null,8,["src","preview-src-list","initial-index"])):q("",!0)]),_:1},8,["label"]),l(c,{property:"targetBlank",label:e.$t("blockItem.targetBlank"),sortable:"custom",width:"120"},{default:o(({row:a})=>[l(j,{modelValue:a.targetBlank,"onUpdate:modelValue":s=>a.targetBlank=s,disabled:n(p)("blockItem:update"),onChange:s=>M({...a,targetBlank:s})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),l(c,{property:"enabled",label:e.$t("enable"),sortable:"custom",width:"100"},{default:o(({row:a})=>[l(j,{modelValue:a.enabled,"onUpdate:modelValue":s=>a.enabled=s,disabled:n(p)("blockItem:update"),onChange:s=>M({...a,enabled:s})},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"]),l(c,{label:e.$t("table.action")},{default:o(({row:a})=>[l($,{type:"primary",disabled:n(p)("blockItem:update"),onClick:s=>F(a.id),size:"small",link:""},{default:o(()=>[V(C(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),l(P,{title:e.$t("confirmDelete"),onConfirm:s=>O([a.id])},{reference:o(()=>[l($,{type:"primary",disabled:n(p)("blockItem:delete"),size:"small",link:""},{default:o(()=>[V(C(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[le,L.value]])]),l(Le,{modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=a=>h.value=a),beanId:S.value,beanIds:n(Q),blockId:Number(r.value),onFinished:u},null,8,["modelValue","beanId","beanIds","blockId"])]}),_:1})]),_:1})}}});const Ae=fe(Ue,[["__scopeId","data-v-9c31a7a6"]]);export{Ae as default};
