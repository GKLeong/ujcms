import{d as F,p as K,r as i,v as W,a as V,c as O,e as G,w as d,i as s,h as l,g as M,u as Y,X as Z,o as x,b as ee,I as le,j as Q,f as ae,aD as te,aI as oe,E as ne,cr as se,k as C,t as B,a4 as de,a1 as re,as as S,V as ue}from"./index-6c60ffba.js";import{x as ie,y as me,z as pe,A as P,q as T,B as ve}from"./user-602b45f1.js";import{a as E,_ as ce,b as fe,c as be}from"./QueryItem.vue_vue_type_script_setup_true_lang-b16aac13.js";import{_ as ge}from"./ListMove.vue_vue_type_script_setup_true_lang-abbfedd1.js";import{d as ye,t as $e}from"./tree-7e647485.js";import{_ as Ve}from"./DialogForm.vue_vue_type_script_setup_true_lang-e536e4f0.js";const he={name:"OrgForm"},Ie=F({...he,props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(y,{emit:L}){const w=y,{showGlobalData:h,modelValue:k}=K(w),f=i(),t=i({}),b=i([]),$=async r=>{b.value=ye($e(await T({current:!h.value})),r==null?void 0:r.id)},D=async r=>{await $(r),L("finished")};return W(k,()=>{k.value&&$()}),(r,u)=>{const q=V("el-tree-select"),v=V("el-form-item"),m=V("el-input");return O(),G(Ve,{name:r.$t("menu.user.org"),queryBean:s(ie),createBean:s(me),updateBean:s(pe),deleteBean:s(P),beanId:y.beanId,beanIds:y.beanIds,focus:f.value,initValues:o=>{var c;return{parentId:(o==null?void 0:o.id)!==y.parentId&&(c=o==null?void 0:o.parentId)!=null?c:y.parentId}},toValues:o=>({...o}),disableDelete:o=>{var c;return o.id<=1||o.id===((c=b.value[0])==null?void 0:c.id)},perms:"org",values:t.value,"onUpdate:values":u[5]||(u[5]=o=>t.value=o),"model-value":y.modelValue,"onUpdate:modelValue":u[6]||(u[6]=o=>r.$emit("update:modelValue",o)),onFinished:D,onBeanChange:$},{default:d(({isEdit:o})=>{var c;return[!o||t.value.id!==((c=b.value[0])==null?void 0:c.id)?(O(),G(v,{key:0,prop:"parentId",label:r.$t("org.parent"),rules:{required:!0,message:()=>r.$t("v.required")}},{default:d(()=>[l(q,{modelValue:t.value.parentId,"onUpdate:modelValue":u[0]||(u[0]=p=>t.value.parentId=p),data:b.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":b.value.map(p=>p.id),"render-after-expand":!1,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])]),_:1},8,["label","rules"])):M("",!0),l(v,{prop:"name",label:r.$t("org.name"),rules:{required:!0,message:()=>r.$t("v.required")}},{default:d(()=>[l(m,{modelValue:t.value.name,"onUpdate:modelValue":u[1]||(u[1]=p=>t.value.name=p),ref_key:"focus",ref:f,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(v,{prop:"address",label:r.$t("org.address")},{default:d(()=>[l(m,{modelValue:t.value.address,"onUpdate:modelValue":u[2]||(u[2]=p=>t.value.address=p),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(v,{prop:"phone",label:r.$t("org.phone")},{default:d(()=>[l(m,{modelValue:t.value.phone,"onUpdate:modelValue":u[3]||(u[3]=p=>t.value.phone=p),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"]),l(v,{prop:"contacts",label:r.$t("org.contacts")},{default:d(()=>[l(m,{modelValue:t.value.contacts,"onUpdate:modelValue":u[4]||(u[4]=p=>t.value.contacts=p),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","values","model-value"])}}}),_e={class:"mb-3"},we={class:"app-block mt-3"},ke={name:"OrgList"},Se=F({...ke,setup(y){const{t:L}=Y(),w=i({}),h=i(),k=i(),f=i([]),t=i([]),b=i(!1),$=i(!1),D=i(),r=Z(()=>f.value.map(e=>e.id)),u=i(!1),q=i(1),v=i(!1),m=async()=>{var e;b.value=!0;try{f.value=await T({...te(w.value),current:!v.value,Q_OrderBy:h.value}),u.value=Object.values(w.value).filter(a=>a!==void 0&&a!=="").length>0||h.value!==void 0,q.value=(e=f.value[0])==null?void 0:e.id}finally{b.value=!1}};x(m);const o=({column:e,prop:a,order:g})=>{var I;a?h.value=((I=e.sortBy)!=null?I:a)+(g==="descending"?"_desc":""):h.value=void 0,m()},c=()=>m(),p=()=>{k.value.clearSort(),oe(w.value),h.value=void 0,m()},R=e=>{D.value=void 0,e!=null&&(q.value=e),$.value=!0},z=e=>{D.value=e,$.value=!0},j=async e=>{await P(e),m(),ne.success(L("success"))},A=e=>e.id>1,X=async(e,a)=>{const g=se(e,f.value,a);await ve(g),await m(),e.forEach(I=>{k.value.toggleRowSelection(f.value.find(N=>N.id===I.id))})};return(e,a)=>{const g=V("el-button"),I=V("el-popconfirm"),N=V("el-checkbox"),_=V("el-table-column"),H=V("el-table"),J=ee("loading");return O(),le("div",null,[Q("div",_e,[l(s(ce),{params:w.value,onSearch:c,onReset:p},{default:d(()=>[l(s(E),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),l(s(E),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),l(s(E),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),l(s(E),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),Q("div",null,[l(g,{type:"primary",icon:s(de),onClick:a[0]||(a[0]=n=>R())},{default:d(()=>[C(B(e.$t("add")),1)]),_:1},8,["icon"]),l(I,{title:e.$t("confirmDelete"),onConfirm:a[1]||(a[1]=n=>j(t.value.map(U=>U.id)))},{reference:d(()=>[l(g,{disabled:t.value.length<=0,icon:s(re)},{default:d(()=>[C(B(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ge,{class:"ml-2",disabled:t.value.length<=0||u.value||s(S)("org:update"),onMove:a[2]||(a[2]=n=>X(t.value,n))},null,8,["disabled"]),s(ue).globalPermission?(O(),G(N,{key:0,class:"ml-2 align-middle",modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=n=>v.value=n),onChange:a[4]||(a[4]=n=>m()),label:e.$t("globalData"),border:""},null,8,["modelValue","label"])):M("",!0),l(s(fe),{name:"org",class:"ml-2"})]),Q("div",we,[ae((O(),G(H,{ref_key:"table",ref:k,"row-key":"id",data:f.value,onSelectionChange:a[5]||(a[5]=n=>t.value=n),onRowDblclick:a[6]||(a[6]=n=>z(n.id)),onSortChange:o},{default:d(()=>[l(s(be),{name:"org"},{default:d(()=>[l(_,{type:"selection",selectable:A,width:"45"}),l(_,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(_,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:d(({row:n})=>[C(B(n.names.join(" / ")),1)]),_:1},8,["label"]),l(_,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(_,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(_,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(_,{label:e.$t("table.action")},{default:d(({row:n})=>[l(g,{type:"primary",disabled:s(S)("org:create"),onClick:U=>R(n.id),size:"small",link:""},{default:d(()=>[C(B(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),l(g,{type:"primary",disabled:s(S)("org:update"),onClick:U=>z(n.id),size:"small",link:""},{default:d(()=>[C(B(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),l(I,{title:e.$t("confirmDelete"),onConfirm:U=>j([n.id])},{reference:d(()=>[l(g,{type:"primary",disabled:!A(n)||s(S)("org:delete"),size:"small",link:""},{default:d(()=>[C(B(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[J,b.value]])]),l(Ie,{modelValue:$.value,"onUpdate:modelValue":a[7]||(a[7]=n=>$.value=n),beanId:D.value,beanIds:s(r),onFinished:m,parentId:q.value,showGlobalData:v.value},null,8,["modelValue","beanId","beanIds","parentId","showGlobalData"])])}}});export{Se as default};
