System.register(["./vendor-legacy.c673f215.js","./index-legacy.ab0556e1.js","./user-legacy.96899cc8.js","./QueryItem-legacy.7783afb6.js","./ListMove-legacy.0c298fbd.js","./DialogForm-legacy.1e3adc37.js","./LabelTip-legacy.f517ffd0.js","./data-legacy.ce93f6d2.js","./tree-legacy.a39fb697.js","./content-legacy.f0511ebc.js"],(function(e){"use strict";var l,a,o,t,n,u,s,i,r,d,m,p,c,v,b,y,f,k,g,h,V,$,_,w,P,C,U,q,x,I,j,A,B,R,S,z,D,M,N,T,H,L,F,G,Q,E,K,O,J,W,X;return{setters:[function(e){l=e.g,a=e.I,o=e.j,t=e.o,n=e.k,u=e.w,s=e.l,i=e.m,r=e.q,d=e.C,m=e.F,p=e.P,c=e.A,v=e.t,b=e.u,y=e.i,f=e.R,k=e.M,g=e.y,h=e.x,V=e.Q,$=e.ax,_=e.N,w=e.aq,P=e.O,C=e.ap},function(e){U=e.h,q=e.m,x=e.o,I=e.w,j=e.B},function(e){A=e.r,B=e.k,R=e.l,S=e.n,z=e.o,D=e.p,M=e.s,N=e.g,T=e.t},function(e){H=e.a,L=e.b,F=e._,G=e.c},function(e){Q=e._},function(e){E=e._},function(e){K=e._},function(e){O=e.b},function(e){J=e.b,W=e.t},function(e){X=e.f}],execute:function(){const Y=l({name:"RoleForm",props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e){const l=a(),v=a({});return(a,b)=>{const y=o("el-input"),f=o("el-form-item"),k=o("el-input-number"),g=o("el-option"),h=o("el-select"),V=o("el-radio"),$=o("el-radio-group");return t(),n(E,{name:a.$t("menu.user.role"),queryBean:i(B),createBean:i(R),updateBean:i(S),deleteBean:i(z),beanId:e.beanId,beanIds:e.beanIds,focus:l.value,initValues:()=>({type:4,rank:i(U).rank+1,scope:0}),toValues:e=>({...e}),disableDelete:e=>e.id<=1,disableEdit:e=>e.global&&!i(U).globalPermission||i(U).rank>e.rank,perms:"role",values:v.value,"onUpdate:values":b[5]||(b[5]=e=>v.value=e),"model-value":e.modelValue,"onUpdate:modelValue":b[6]||(b[6]=e=>a.$emit("update:modelValue",e)),onFinished:b[7]||(b[7]=e=>a.$emit("finished"))},{default:u((({bean:e,disabled:o})=>[s(f,{prop:"name",label:a.$t("role.name"),rules:{required:!0,message:()=>a.$t("v.required")}},{default:u((()=>[s(y,{modelValue:v.value.name,"onUpdate:modelValue":b[0]||(b[0]=e=>v.value.name=e),ref_key:"focus",ref:l,maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"]),s(f,{prop:"description",label:a.$t("role.description")},{default:u((()=>[s(y,{modelValue:v.value.description,"onUpdate:modelValue":b[1]||(b[1]=e=>v.value.description=e),maxlength:"300"},null,8,["modelValue"])])),_:1},8,["label"]),s(f,{prop:"rank",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:u((()=>[s(K,{message:"role.rank",help:""})])),default:u((()=>[s(k,{modelValue:v.value.rank,"onUpdate:modelValue":b[2]||(b[2]=e=>v.value.rank=e),modelModifiers:{number:!0},min:o?0:i(U).rank,max:32767},null,8,["modelValue","min"])])),_:2},1032,["rules"]),s(f,{prop:"type",rules:[{required:!0,message:()=>a.$t("v.required")},{validator:(e,l,o)=>{[1,2,3].includes(l)&&i(U).epRank<1&&o(a.$t("error.enterprise.short")),o()}}]},{label:u((()=>[s(K,{message:"role.type",help:""})])),default:u((()=>[s(h,{modelValue:v.value.type,"onUpdate:modelValue":b[3]||(b[3]=e=>v.value.type=e)},{default:u((()=>[(t(),r(m,null,d([1,2,3,4],(e=>s(g,{key:e,label:a.$t(`role.type.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"]),s(f,{prop:"scope",label:a.$t("block.scope"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(l,o,t)=>{o!==e.scope&&await i(A)(v.value.scope)&&t(a.$t("role.error.scopeNotAllowd")),t()}}]},{default:u((()=>[s($,{modelValue:v.value.scope,"onUpdate:modelValue":b[4]||(b[4]=e=>v.value.scope=e)},{default:u((()=>[(t(),r(m,null,d([0,2],(e=>s(V,{key:e,label:e,disabled:!i(U).globalPermission},{default:u((()=>[p(c(a.$t(`role.scope.${e}`)),1)])),_:2},1032,["label","disabled"]))),64))])),_:1},8,["modelValue"])])),_:2},1032,["label","rules"])])),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","disableEdit","values","model-value"])}}}),Z={class:"border-t"},ee={class:"border-t"},le=["innerHTML"],ae=["innerHTML"],oe={class:"border-t"},te=["innerHTML"],ne={class:"flex justify-between items-center"},ue=l({name:"RolePermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){var _;const w=e,{beanId:P,modelValue:C}=v(w),{t:q}=b(),x=a("permission"),I=a(),j=a({}),A=a({}),R=a(!1),S=a(!0),z=a(!1),N=a(),T=a(!0),H=a(!1),L=a(),F=a(!0),G=a(!1),Q=a(),E=O();J(E,null!==(_=U.grantPermissions)&&void 0!==_?_:[]);const Y=a([]),ue=y((()=>j.value.global&&!U.globalPermission||U.rank>j.value.rank));f(C,(async()=>{C.value&&(await(async()=>{null!=(null==P?void 0:P.value)&&(j.value=await B(P.value),A.value={...j.value},$().then((()=>{var e,l,a,o,t,n;null===(e=N.value)||void 0===e||e.setCheckedKeys(null!==(l=null===(a=j.value.permission)||void 0===a?void 0:a.split(","))&&void 0!==l?l:[]),null===(o=L.value)||void 0===o||o.setCheckedKeys(null!==(t=null===(n=j.value.grantPermission)||void 0===n?void 0:n.split(","))&&void 0!==t?t:[])})))})(),(async()=>{null!=(null==P?void 0:P.value)&&(await M(P.value)).forEach((e=>{var l;null===(l=Q.value)||void 0===l||l.setChecked(e,!0,!1)}))})())})),k((()=>{(async()=>{Y.value=W(await X())})()}));const se=(e,l,a,o)=>{a.forEach((a=>{a.children&&(l.getNode(a[null!=o?o:"key"]).expanded=e,se(e,l,a.children,o))}))},ie=(e,l,a,o)=>{l.setCheckedKeys(e?a.map((e=>e[null!=o?o:"key"])):[])},re=()=>{null!=N.value&&(A.value.permission=pe(N.value.getCheckedNodes(),N.value.getHalfCheckedNodes()))},de=()=>{null!=L.value&&(A.value.grantPermission=pe(L.value.getCheckedNodes(),L.value.getHalfCheckedNodes()))},me=()=>{null!=Q.value&&(A.value.articlePermissions=[...Q.value.getCheckedNodes(),...Q.value.getHalfCheckedNodes()].map((e=>e.id)))},pe=(e,l)=>[...e,...l].filter((e=>e.perms)).map((e=>{var l;return null===(l=e.perms)||void 0===l?void 0:l.join(",")})).join(",");return(a,v)=>{const b=o("el-alert"),y=o("el-switch"),f=o("el-form-item"),k=o("el-checkbox"),$=o("el-tree"),_=o("el-tab-pane"),w=o("el-option"),P=o("el-select"),C=o("el-tabs"),j=o("el-form"),B=o("el-tag"),M=o("el-button"),O=o("el-drawer");return t(),n(O,{title:a.$t("permissionSettings"),"with-header":!1,"model-value":e.modelValue,"onUpdate:modelValue":v[23]||(v[23]=e=>a.$emit("update:modelValue",e)),size:576},{default:u((()=>[s(j,{ref_key:"form",ref:I,model:A.value,disabled:i(ue),"label-width":"150px"},{default:u((()=>[s(C,{modelValue:x.value,"onUpdate:modelValue":v[20]||(v[20]=e=>x.value=e)},{default:u((()=>[s(_,{label:a.$t("role.permission"),name:"permission"},{default:u((()=>[s(b,{title:a.$t("role.permission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),s(f,{prop:"allPermission"},{label:u((()=>[s(K,{message:"role.allPermission"})])),default:u((()=>[s(y,{modelValue:A.value.allPermission,"onUpdate:modelValue":v[0]||(v[0]=e=>A.value.allPermission=e)},null,8,["modelValue"])])),_:1}),A.value.allPermission?h("",!0):(t(),r(m,{key:0},[g("div",Z,[s(k,{modelValue:S.value,"onUpdate:modelValue":v[1]||(v[1]=e=>S.value=e),onChange:v[2]||(v[2]=e=>se(e,N.value,i(E))),disabled:!1,label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:z.value,"onUpdate:modelValue":v[3]||(v[3]=e=>z.value=e),onChange:v[4]||(v[4]=e=>{ie(e,N.value,i(E)),re()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"permissionTree",ref:N,data:i(E),"node-key":"key",onCheck:v[5]||(v[5]=e=>re()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))])),_:1},8,["label"]),i(U).epRank>=1||i(U).epDisplay?(t(),n(_,{key:0,label:a.$t("role.grantPermission"),name:"grantPermission"},{default:u((()=>[i(U).epRank>=1?(t(),r(m,{key:0},[s(b,{title:a.$t("role.grantPermission.tooltip"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),s(f,{prop:"allGrantPermission",class:"mt-3"},{label:u((()=>[s(K,{message:"role.allGrantPermission"})])),default:u((()=>[s(y,{modelValue:A.value.allGrantPermission,"onUpdate:modelValue":v[6]||(v[6]=e=>A.value.allGrantPermission=e)},null,8,["modelValue"])])),_:1}),A.value.allGrantPermission?h("",!0):(t(),r(m,{key:0},[g("div",ee,[s(k,{modelValue:T.value,"onUpdate:modelValue":v[7]||(v[7]=e=>T.value=e),onChange:v[8]||(v[8]=e=>se(e,L.value,i(E))),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:H.value,"onUpdate:modelValue":v[9]||(v[9]=e=>H.value=e),onChange:v[10]||(v[10]=e=>{ie(e,L.value,i(E)),de()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"grantPermissionTree",ref:L,data:i(E),"node-key":"key",onCheck:v[11]||(v[11]=e=>de()),class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,le)])),_:1}))])),_:1},8,["label"])):h("",!0),i(U).epRank>=1||i(U).epDisplay?(t(),n(_,{key:1,label:a.$t("role.dataPermission"),name:"dataPermission"},{default:u((()=>[i(U).epRank>=1?(t(),r(m,{key:0},[s(f,{prop:"globalPermission",rules:{required:!0,message:()=>a.$t("v.required")}},{label:u((()=>[s(K,{message:"role.globalPermission",help:""})])),default:u((()=>[s(y,{modelValue:A.value.globalPermission,"onUpdate:modelValue":v[12]||(v[12]=e=>A.value.globalPermission=e),disabled:!i(U).globalPermission},null,8,["modelValue","disabled"])])),_:1},8,["rules"]),s(f,{prop:"dataScope",rules:[{required:!0,message:()=>a.$t("v.required")}]},{label:u((()=>[s(K,{message:"role.dataScope",help:""})])),default:u((()=>[s(P,{modelValue:A.value.dataScope,"onUpdate:modelValue":v[13]||(v[13]=e=>A.value.dataScope=e)},{default:u((()=>[(t(),r(m,null,d([1,2,3],(e=>s(w,{key:e,label:a.$t(`role.dataScope.${e}`),value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["rules"])],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,ae)])),_:1}))])),_:1},8,["label"])):h("",!0),i(U).epRank>=1||i(U).epDisplay?(t(),n(_,{key:2,label:a.$t("role.articlePermission"),name:"articlePermission"},{default:u((()=>[i(U).epRank>=1?(t(),r(m,{key:0},[s(f,{prop:"allArticlePermission"},{label:u((()=>[s(K,{message:"role.allArticlePermission",help:""})])),default:u((()=>[s(y,{modelValue:A.value.allArticlePermission,"onUpdate:modelValue":v[14]||(v[14]=e=>A.value.allArticlePermission=e)},null,8,["modelValue"])])),_:1}),A.value.allArticlePermission?h("",!0):(t(),r(m,{key:0},[g("div",oe,[s(k,{modelValue:F.value,"onUpdate:modelValue":v[15]||(v[15]=e=>F.value=e),onChange:v[16]||(v[16]=e=>se(e,Q.value,Y.value,"id")),label:a.$t("expand/collapse")},null,8,["modelValue","label"]),s(k,{modelValue:G.value,"onUpdate:modelValue":v[17]||(v[17]=e=>G.value=e),onChange:v[18]||(v[18]=e=>{ie(e,Q.value,Y.value,"id"),me()}),label:a.$t("checkAll/uncheckAll")},null,8,["modelValue","label"])]),s($,{ref_key:"articlePermissionTree",ref:Q,data:Y.value,"node-key":"id",onCheck:v[19]||(v[19]=e=>me()),props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":""},null,8,["data"])],64))],64)):(t(),n(b,{key:1,type:"warning",closable:!1,"show-icon":!0},{title:u((()=>[g("span",{innerHTML:a.$t("error.enterprise.short")},null,8,te)])),_:1}))])),_:1},8,["label"])):h("",!0)])),_:1},8,["modelValue"])])),_:1},8,["model","disabled"])])),footer:u((()=>[g("div",ne,[g("div",null,[s(B,null,{default:u((()=>{var e;return[p(c(null===(e=A.value)||void 0===e?void 0:e.name),1)]})),_:1})]),g("div",null,[s(M,{onClick:v[21]||(v[21]=e=>a.$emit("update:modelValue",!1))},{default:u((()=>[p(c(a.$t("cancel")),1)])),_:1}),s(M,{type:"primary",onClick:v[22]||(v[22]=e=>{I.value.validate((async e=>{if(e){R.value=!0;try{re(),de(),me(),await D(A.value),l("finished"),l("update:modelValue",!1),V.success(q("success"))}finally{R.value=!1}}}))}),loading:R.value,disabled:i(ue)},{default:u((()=>[p(c(a.$t("save")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["title","model-value"])}}}),se={class:"mb-3"};e("default",l({name:"RoleList",setup(e){const{t:l}=b(),d=a({}),m=a(),v=a(),f=a([]),h=a([]),$=a(!1),A=a(!1),B=a(!1),R=a(),S=y((()=>f.value.map((e=>e.id)))),D=a(!1),M=async()=>{$.value=!0;try{f.value=await N({...x(d.value),Q_OrderBy:m.value}),D.value=Object.values(d.value).filter((e=>void 0!==e&&""!==e)).length>0||void 0!==m.value}finally{$.value=!1}};k(M);const E=e=>e.global&&!U.globalPermission||U.rank>e.rank,K=({column:e,prop:l,order:a})=>{var o;m.value=l?(null!==(o=e.sortBy)&&void 0!==o?o:l)+("descending"===a?"_desc":""):void 0,M()},O=()=>M(),J=()=>{v.value.clearSort(),I(d.value),m.value=void 0,M()},W=()=>{R.value=void 0,A.value=!0},X=e=>{R.value=e,A.value=!0},Z=async e=>{await z(e),M(),V.success(l("success"))};return(e,l)=>{const a=o("el-button"),m=o("el-popconfirm"),b=o("el-table-column"),y=o("el-tag"),k=o("el-table"),V=_("loading");return t(),r("div",null,[g("div",se,[s(i(H),{params:d.value,onSearch:O,onReset:J},{default:u((()=>[s(i(F),{label:e.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),s(i(F),{label:e.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])])),_:1},8,["params"])]),g("div",null,[s(a,{type:"primary",icon:i(w),onClick:W},{default:u((()=>[p(c(e.$t("add")),1)])),_:1},8,["icon"]),s(m,{title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=e=>Z(h.value.map((e=>e.id))))},{reference:u((()=>[s(a,{disabled:h.value.length<=0,icon:i(C)},{default:u((()=>[p(c(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),s(Q,{class:"ml-2",disabled:h.value.length<=0||D.value||i(q)("role:update"),onMove:l[1]||(l[1]=e=>(async(e,l)=>{const a=j(e,f.value,l);await T(a.map((e=>e.id)))})(h.value,e))},null,8,["disabled"]),s(i(L),{name:"role",class:"ml-2"})]),P((t(),n(k,{ref_key:"table",ref:v,data:f.value,onSelectionChange:l[2]||(l[2]=e=>h.value=e),onRowDblclick:l[3]||(l[3]=e=>X(e.id)),onSortChange:K,class:"mt-3 shadow bg-white"},{default:u((()=>[s(i(G),{name:"role"},{default:u((()=>[s(b,{type:"selection",selectable:e=>!E(e),width:"50"},null,8,["selectable"]),s(b,{property:"id",label:"ID",width:"64",sortable:"custom"}),s(b,{property:"name",label:e.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"description",label:e.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"rank",label:e.$t("role.rank"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),s(b,{property:"globalPermission",label:e.$t("role.globalPermission"),sortable:"custom"},{default:u((({row:l})=>[s(y,{type:l.globalPermission?"success":"info",size:"small"},{default:u((()=>[p(c(e.$t(l.globalPermission?"yes":"no")),1)])),_:2},1032,["type"])])),_:1},8,["label"]),s(b,{property:"type",label:e.$t("role.type"),sortable:"custom"},{default:u((({row:l})=>[1===l.type?(t(),n(y,{key:0,size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):2===l.type?(t(),n(y,{key:1,type:"warning",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):3===l.type?(t(),n(y,{key:2,type:"success",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024)):(t(),n(y,{key:3,type:"info",size:"small"},{default:u((()=>[p(c(e.$t(`role.type.${l.type}`)),1)])),_:2},1024))])),_:1},8,["label"]),s(b,{property:"scope",label:e.$t("role.scope"),sortable:"custom"},{default:u((({row:l})=>[2===l.scope?(t(),n(y,{key:0,type:"success",size:"small"},{default:u((()=>[p(c(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024)):(t(),n(y,{key:1,type:"info",size:"small"},{default:u((()=>[p(c(e.$t(`role.scope.${l.scope}`)),1)])),_:2},1024))])),_:1},8,["label"]),s(b,{label:e.$t("table.action"),width:"160"},{default:u((({row:l})=>[s(a,{type:"primary",onClick:e=>X(l.id),disabled:i(q)("role:update"),size:"small",link:""},{default:u((()=>[p(c(e.$t("edit")),1)])),_:2},1032,["onClick","disabled"]),s(a,{type:"primary",onClick:e=>{return a=l.id,R.value=a,void(B.value=!0);var a},disabled:i(q)("role:updatePermission"),size:"small",link:""},{default:u((()=>[p(c(e.$t("permissionSettings")),1)])),_:2},1032,["onClick","disabled"]),s(m,{title:e.$t("confirmDelete"),onConfirm:e=>Z([l.id])},{reference:u((()=>[s(a,{type:"primary",size:"small",disabled:E(l),link:""},{default:u((()=>[p(c(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data"])),[[V,$.value]]),s(Y,{modelValue:A.value,"onUpdate:modelValue":l[4]||(l[4]=e=>A.value=e),beanId:R.value,beanIds:i(S),onFinished:M},null,8,["modelValue","beanId","beanIds"]),s(ue,{modelValue:B.value,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value=e),beanId:R.value,onFinished:M},null,8,["modelValue","beanId"])])}}}))}}}));
