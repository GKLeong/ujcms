var x=Object.defineProperty,ee=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var T=(d,p,u)=>p in d?x(d,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[p]=u,U=(d,p)=>{for(var u in p||(p={}))ae.call(p,u)&&T(d,u,p[u]);if(F)for(var u of F(p))te.call(p,u)&&T(d,u,p[u]);return d},Q=(d,p)=>ee(d,le(p));import{m as R,h as oe,o as ne,w as se,A as de}from"./index.35346a57.js";import{g as H,t as re,I as v,R as ue,j as w,o as S,k as L,w as r,l,x as J,m as s,u as ie,i as me,M as pe,N as ve,q as fe,y as A,aq as ce,O as be,Q as ge,P as B,A as D,ap as ye}from"./vendor.7e46e91a.js";import{v as $e,w as Ve,x as he,y as K,q as W,z as we}from"./user.72ed5abb.js";import{a as _e,b as Ie,_ as G,c as ke}from"./QueryItem.713a2356.js";import{_ as Ce}from"./ListMove.34265a1e.js";import{d as Be,t as De}from"./tree.4a0f1dfa.js";import{_ as qe}from"./DialogForm.5f4b290f.js";const Oe={name:"OrgForm"},Ue=H(Q(U({},Oe),{props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(d,{emit:p}){const u=d,{showGlobalData:_,modelValue:C}=re(u),y=v(),t=v({}),$=v([]),h=async i=>{$.value=Be(De(await W({current:!_.value})),i==null?void 0:i.id)},q=async i=>{await h(i),p("finished")};return ue(C,()=>{C.value&&h()}),(i,m)=>{const O=w("el-tree-select"),b=w("el-form-item"),f=w("el-input");return S(),L(qe,{name:i.$t("menu.user.org"),queryBean:s($e),createBean:s(Ve),updateBean:s(he),deleteBean:s(K),beanId:d.beanId,beanIds:d.beanIds,focus:y.value,initValues:o=>{var g;return{parentId:(o==null?void 0:o.id)!==d.parentId&&(g=o==null?void 0:o.parentId)!=null?g:d.parentId}},toValues:o=>U({},o),disableDelete:o=>{var g;return o.id<=1||o.id===((g=$.value[0])==null?void 0:g.id)},perms:"org",values:t.value,"onUpdate:values":m[5]||(m[5]=o=>t.value=o),"model-value":d.modelValue,"onUpdate:modelValue":m[6]||(m[6]=o=>i.$emit("update:modelValue",o)),onFinished:q,onBeanChange:h},{default:r(({isEdit:o})=>{var g;return[!o||t.value.id!==((g=$.value[0])==null?void 0:g.id)?(S(),L(b,{key:0,prop:"parentId",label:i.$t("org.parent"),rules:{required:!0,message:()=>i.$t("v.required")}},{default:r(()=>[l(O,{modelValue:t.value.parentId,"onUpdate:modelValue":m[0]||(m[0]=c=>t.value.parentId=c),data:$.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":$.value.map(c=>c.id),"render-after-expand":!1,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])]),_:1},8,["label","rules"])):J("",!0),l(b,{prop:"name",label:i.$t("org.name"),rules:{required:!0,message:()=>i.$t("v.required")}},{default:r(()=>[l(f,{modelValue:t.value.name,"onUpdate:modelValue":m[1]||(m[1]=c=>t.value.name=c),ref_key:"focus",ref:y,maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(b,{prop:"address",label:i.$t("org.address")},{default:r(()=>[l(f,{modelValue:t.value.address,"onUpdate:modelValue":m[2]||(m[2]=c=>t.value.address=c),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{prop:"phone",label:i.$t("org.phone")},{default:r(()=>[l(f,{modelValue:t.value.phone,"onUpdate:modelValue":m[3]||(m[3]=c=>t.value.phone=c),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{prop:"contacts",label:i.$t("org.contacts")},{default:r(()=>[l(f,{modelValue:t.value.contacts,"onUpdate:modelValue":m[4]||(m[4]=c=>t.value.contacts=c),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","values","model-value"])}}})),Se={class:"mb-3"},Ne={class:"app-block mt-3"},Qe={name:"OrgList"},je=H(Q(U({},Qe),{setup(d){const{t:p}=ie(),u=v({}),_=v(),C=v(),y=v([]),t=v([]),$=v(!1),h=v(!1),q=v(),i=me(()=>y.value.map(e=>e.id)),m=v(!1),O=v(1),b=v(!1),f=async()=>{var e;$.value=!0;try{y.value=await W(Q(U({},ne(u.value)),{current:!b.value,Q_OrderBy:_.value})),m.value=Object.values(u.value).filter(a=>a!==void 0&&a!=="").length>0||_.value!==void 0,O.value=(e=y.value[0])==null?void 0:e.id}finally{$.value=!1}};pe(f);const o=({column:e,prop:a,order:V})=>{var I;a?_.value=((I=e.sortBy)!=null?I:a)+(V==="descending"?"_desc":""):_.value=void 0,f()},g=()=>f(),c=()=>{C.value.clearSort(),se(u.value),_.value=void 0,f()},E=e=>{q.value=void 0,e!=null&&(O.value=e),h.value=!0},M=e=>{q.value=e,h.value=!0},P=async e=>{await K(e),f(),ge.success(p("success"))},j=e=>e.id>1,X=async(e,a)=>{const V=de(e,y.value,a);await we(V),await f(),e.forEach(I=>{C.value.toggleRowSelection(y.value.find(z=>z.id===I.id))})};return(e,a)=>{const V=w("el-button"),I=w("el-popconfirm"),z=w("el-checkbox"),k=w("el-table-column"),Y=w("el-table"),Z=ve("loading");return S(),fe("div",null,[A("div",Se,[l(s(_e),{params:u.value,onSearch:g,onReset:c},{default:r(()=>[l(s(G),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),l(s(G),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),l(s(G),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),l(s(G),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),A("div",null,[l(V,{type:"primary",icon:s(ce),onClick:a[0]||(a[0]=n=>E())},{default:r(()=>[B(D(e.$t("add")),1)]),_:1},8,["icon"]),l(I,{title:e.$t("confirmDelete"),onConfirm:a[1]||(a[1]=n=>P(t.value.map(N=>N.id)))},{reference:r(()=>[l(V,{disabled:t.value.length<=0,icon:s(ye)},{default:r(()=>[B(D(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(Ce,{class:"ml-2",disabled:t.value.length<=0||m.value||s(R)("org:update"),onMove:a[2]||(a[2]=n=>X(t.value,n))},null,8,["disabled"]),s(oe).globalPermission?(S(),L(z,{key:0,class:"ml-2 align-middle",modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=n=>b.value=n),onChange:a[4]||(a[4]=n=>f()),label:e.$t("globalData"),border:""},null,8,["modelValue","label"])):J("",!0),l(s(Ie),{name:"org",class:"ml-2"})]),A("div",Ne,[be((S(),L(Y,{ref_key:"table",ref:C,"row-key":"id",data:y.value,onSelectionChange:a[5]||(a[5]=n=>t.value=n),onRowDblclick:a[6]||(a[6]=n=>M(n.id)),onSortChange:o},{default:r(()=>[l(s(ke),{name:"org"},{default:r(()=>[l(k,{type:"selection",selectable:j,width:"45"}),l(k,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(k,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:r(({row:n})=>[B(D(n.names.join(" / ")),1)]),_:1},8,["label"]),l(k,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(k,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(k,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(k,{label:e.$t("table.action")},{default:r(({row:n})=>[l(V,{type:"primary",disabled:s(R)("org:create"),onClick:N=>E(n.id),size:"small",link:""},{default:r(()=>[B(D(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),l(V,{type:"primary",disabled:s(R)("org:update"),onClick:N=>M(n.id),size:"small",link:""},{default:r(()=>[B(D(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),l(I,{title:e.$t("confirmDelete"),onConfirm:N=>P([n.id])},{reference:r(()=>[l(V,{type:"primary",disabled:!j(n)||s(R)("org:delete"),size:"small",link:""},{default:r(()=>[B(D(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[Z,$.value]])]),l(Ue,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=n=>h.value=n),beanId:q.value,beanIds:s(i),onFinished:f,parentId:O.value,showGlobalData:b.value},null,8,["modelValue","beanId","beanIds","parentId","showGlobalData"])])}}}));export{je as default};
